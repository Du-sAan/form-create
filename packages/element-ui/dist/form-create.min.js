/*!
 * @form-create/element-ui v3.2.15
 * (c) 2018-2024 xaboy
 * Github https://github.com/xaboy/form-create
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).formCreate={},e.Vue)}(this,(function(e,t){"use strict";function i(e,t){return Object.keys(e).reduce(((i,r)=>(t&&-1!==t.indexOf(r)||i.push(e[r]),i)),[])}function r(e){return Array.isArray(e)?e:[null,void 0,""].indexOf(e)>-1?[]:[e]}var n=t.defineComponent({name:"fcCheckbox",inheritAttrs:!1,props:{formCreateInject:Object,modelValue:{type:Array,default:()=>[]},type:String,options:Array,input:Boolean,inputValue:String},emits:["update:modelValue","fc.el"],setup(e,i){const n=t.toRef(e.formCreateInject,"options",[]),o=t.toRef(e,"options"),s=t.toRef(e,"modelValue"),a=t.toRef(e,"inputValue",""),l=t.ref(a.value),c=t.toRef(e,"input",!1),u=e=>{const t=[...r(s.value)],i=t.indexOf(l.value);l.value=e,i>-1&&(t.splice(i,1),t.push(e),h(t))};t.watch(a,(e=>{c.value?u(e):l.value=e}));const d=t.computed((()=>{let e=n.value||[];return o.value&&(e=o.value||[]),Array.isArray(e)?e:[]}));t.watch(s,(e=>{let t=null;if(!a.value&&null!=e&&Array.isArray(e)&&e.length>0&&c.value){const i=d.value.map((e=>e.value));e.forEach((e=>{-1===i.indexOf(e)&&(t=e)}))}null!=t&&(l.value=t)}),{immediate:!0});const h=e=>{i.emit("update:modelValue",e)};return{options:d,value:s,onInput:h,updateCustomValue:u,makeInput(e){if(c.value)return t.createVNode(e,{value:l.value||void 0,label:l.value||void 0},{default:()=>[t.createVNode(t.resolveComponent("ElInput"),{size:"small",modelValue:l.value,"onUpdate:modelValue":u},null)]})}}},render(){var e,r;const n="button"===this.type?"ElCheckboxButton":"ElCheckbox",o=t.resolveComponent(n);return t.createVNode(t.resolveComponent("ElCheckboxGroup"),t.mergeProps(this.$attrs,{modelValue:this.value,"onUpdate:modelValue":this.onInput,ref:"el"}),{default:()=>[this.options.map(((e,i)=>{const r={...e},s=r.value,a=r.label;return delete r.value,delete r.label,t.createVNode(o,t.mergeProps(r,{label:s,value:s,key:n+i+"-"+s}),{default:()=>[a||s||""]})})),null===(e=(r=this.$slots).default)||void 0===e?void 0:e.call(r),this.makeInput(o)],...i(this.$slots,["default"])})},mounted(){this.$emit("fc.el",this.$refs.el)}});function o(e){e=e||new Map;const t={$on(t,i){const r=e.get(t);r&&r.push(i)||e.set(t,[i])},$once(e,i){i._once=!0,t.$on(e,i)},$off(t,i){const r=e.get(t);r&&r.splice(r.indexOf(i)>>>0,1)},$emit(i,...r){(e.get(i)||[]).slice().map((e=>{e._once&&(t.$off(i,e),delete e._once),e(...r)})),(e.get("*")||[]).slice().map((e=>{e(i,r)}))}};return t}function s(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}s("._fc-frame ._fc-files img{display:inline-block;height:100%;vertical-align:top;width:100%}._fc-frame ._fc-upload-btn{border:1px dashed #c0ccda;cursor:pointer}._fc-frame._fc-disabled ._fc-upload-btn,._fc-frame._fc-disabled .el-button{color:#999;cursor:not-allowed!important}._fc-frame ._fc-upload-cover{background:rgba(0,0,0,.6);bottom:0;left:0;opacity:0;position:absolute;right:0;top:0;-webkit-transition:opacity .3s;-o-transition:opacity .3s;transition:opacity .3s}._fc-frame ._fc-upload-cover i{color:#fff;cursor:pointer;font-size:20px;margin:0 2px}._fc-frame ._fc-files:hover ._fc-upload-cover{opacity:1}._fc-frame .el-upload{display:block}._fc-frame ._fc-upload-icon{cursor:pointer}._fc-files,._fc-frame ._fc-upload-btn{background:#fff;border:1px solid #c0ccda;border-radius:4px;-webkit-box-shadow:2px 2px 5px rgba(0,0,0,.1);box-shadow:2px 2px 5px rgba(0,0,0,.1);-webkit-box-sizing:border-box;box-sizing:border-box;display:inline-block;height:58px;line-height:58px;margin-right:4px;overflow:hidden;position:relative;text-align:center;width:58px}");var a={name:"IconCircleClose"};const l={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"};a.render=function(e,i,r,n,o,s){return t.openBlock(),t.createElementBlock("svg",l,i[0]||(i[0]=[t.createElementVNode("path",{fill:"currentColor",d:"M466.752 512l-90.496-90.496a32 32 0 0145.248-45.248L512 466.752l90.496-90.496a32 32 0 1145.248 45.248L557.248 512l90.496 90.496a32 32 0 11-45.248 45.248L512 557.248l-90.496 90.496a32 32 0 01-45.248-45.248L466.752 512z"},null,-1),t.createElementVNode("path",{fill:"currentColor",d:"M512 896a384 384 0 100-768 384 384 0 000 768zm0 64a448 448 0 110-896 448 448 0 010 896z"},null,-1)]))};var c={name:"IconDocument"};const u={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"};c.render=function(e,i,r,n,o,s){return t.openBlock(),t.createElementBlock("svg",u,i[0]||(i[0]=[t.createElementVNode("path",{fill:"currentColor",d:"M832 384H576V128H192v768h640V384zm-26.496-64L640 154.496V320h165.504zM160 64h480l256 256v608a32 32 0 01-32 32H160a32 32 0 01-32-32V96a32 32 0 0132-32zm160 448h384v64H320v-64zm0-192h160v64H320v-64zm0 384h384v64H320v-64z"},null,-1)]))};var d={name:"IconDelete"};const h={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"};d.render=function(e,i,r,n,o,s){return t.openBlock(),t.createElementBlock("svg",h,i[0]||(i[0]=[t.createElementVNode("path",{fill:"currentColor",d:"M160 256H96a32 32 0 010-64h256V95.936a32 32 0 0132-32h256a32 32 0 0132 32V192h256a32 32 0 110 64h-64v672a32 32 0 01-32 32H192a32 32 0 01-32-32V256zm448-64v-64H416v64h192zM224 896h576V256H224v640zm192-128a32 32 0 01-32-32V416a32 32 0 0164 0v320a32 32 0 01-32 32zm192 0a32 32 0 01-32-32V416a32 32 0 0164 0v320a32 32 0 01-32 32z"},null,-1)]))};var p={name:"IconView"};const f={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"};p.render=function(e,i,r,n,o,s){return t.openBlock(),t.createElementBlock("svg",f,i[0]||(i[0]=[t.createElementVNode("path",{fill:"currentColor",d:"M512 160c320 0 512 352 512 352S832 864 512 864 0 512 0 512s192-352 512-352zm0 64c-225.28 0-384.128 208.064-436.8 288 52.608 79.872 211.456 288 436.8 288 225.28 0 384.128-208.064 436.8-288-52.608-79.872-211.456-288-436.8-288zm0 64a224 224 0 110 448 224 224 0 010-448zm0 64a160.192 160.192 0 00-160 160c0 88.192 71.744 160 160 160s160-71.808 160-160-71.744-160-160-160z"},null,-1)]))};var m={name:"IconFolderOpened"};const g={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"};function v(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!t.isVNode(e)}m.render=function(e,i,r,n,o,s){return t.openBlock(),t.createElementBlock("svg",g,i[0]||(i[0]=[t.createElementVNode("path",{fill:"currentColor",d:"M878.08 448H241.92l-96 384h636.16l96-384zM832 384v-64H485.76L357.504 192H128v448l57.92-231.744A32 32 0 01216.96 384H832zm-24.96 512H96a32 32 0 01-32-32V160a32 32 0 0132-32h287.872l128.384 128H864a32 32 0 0132 32v96h23.04a32 32 0 0131.04 39.744l-112 448A32 32 0 01807.04 896z"},null,-1)]))};var y=t.defineComponent({name:"fcFrame",props:{type:{type:String,default:"input"},field:String,helper:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},src:{type:String,required:!0},icon:{type:String,default:"IconFolderOpened"},width:{type:String,default:"500px"},height:{type:String,default:"370px"},maxLength:{type:Number,default:0},okBtnText:{type:String,default:"确定"},closeBtnText:{type:String,default:"关闭"},modalTitle:String,handleIcon:{type:[String,Boolean],default:void 0},title:String,allowRemove:{type:Boolean,default:!0},onOpen:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}},onCancel:{type:Function,default:()=>{}},onLoad:{type:Function,default:()=>{}},onBeforeRemove:{type:Function,default:()=>{}},onRemove:{type:Function,default:()=>{}},onHandle:Function,modal:{type:Object,default:()=>({})},srcKey:[String,Number],modelValue:[Array,String,Number,Object],previewMask:void 0,footer:{type:Boolean,default:!0},reload:{type:Boolean,default:!0},closeBtn:{type:Boolean,default:!0},okBtn:{type:Boolean,default:!0},formCreateInject:Object},emits:["update:modelValue","change"],components:{IconFolderOpened:m,IconView:p},data(){return{fileList:r(this.modelValue),previewVisible:!1,frameVisible:!1,previewImage:"",bus:new o}},watch:{modelValue(e){this.fileList=r(e)}},methods:{close(){this.closeModel(!0)},closeModel(e){this.bus.$emit(e?"$close":"$ok"),this.reload&&(this.bus.$off("$ok"),this.bus.$off("$close")),this.frameVisible=!1},handleCancel(){this.previewVisible=!1},showModel(){this.disabled||!1===this.onOpen()||(this.frameVisible=!0)},input(){const e=this.fileList,t=1===this.maxLength?e[0]||"":e;this.$emit("update:modelValue",t),this.$emit("change",t)},makeInput(){return t.createVNode(t.resolveComponent("ElInput"),t.mergeProps({type:"text",modelValue:this.fileList.map((e=>this.getSrc(e))).toString(),readonly:!0},{key:1}),{append:()=>t.createVNode(t.resolveComponent("ElButton"),{icon:t.resolveComponent(this.icon),onClick:()=>this.showModel()},null),suffix:()=>this.fileList.length&&!this.disabled?t.createVNode(t.resolveComponent("ElIcon"),{class:"el-input__icon _fc-upload-icon",onClick:()=>{this.fileList=[],this.input()}},{default:()=>[t.createVNode(a,null,null)]}):null})},makeGroup(e){return(!this.maxLength||this.fileList.length<this.maxLength)&&e.push(this.makeBtn()),t.createVNode("div",{key:2},[e])},makeItem:(e,i)=>t.createVNode("div",{class:"_fc-files",key:"3"+e},[i]),valid(e){const t=this.formCreateInject.field||this.field;if(t&&e!==t)throw new Error("[frame]无效的字段值")},makeIcons(e,i){if(!1!==this.handleIcon||!0===this.allowRemove){const r=[];return("file"!==this.type&&!1!==this.handleIcon||"file"===this.type&&this.handleIcon)&&r.push(this.makeHandleIcon(e,i)),this.allowRemove&&r.push(this.makeRemoveIcon(e,i)),t.createVNode("div",{class:"_fc-upload-cover",key:4},[r])}},makeHandleIcon(e,i){const r=t.resolveComponent(!0===this.handleIcon||void 0===this.handleIcon?"icon-view":this.handleIcon);return t.createVNode(t.resolveComponent("ElIcon"),{onClick:()=>this.handleClick(e),key:"5"+i},{default:()=>[t.createVNode(r,null,null)]})},makeRemoveIcon(e,i){return t.createVNode(t.resolveComponent("ElIcon"),{onClick:()=>this.handleRemove(e),key:"6"+i},{default:()=>[t.createVNode(d,null,null)]})},makeFiles(){return this.makeGroup(this.fileList.map(((e,i)=>this.makeItem(i,[t.createVNode(t.resolveComponent("ElIcon"),{onClick:()=>this.handleClick(e)},{default:()=>[t.createVNode(c,null,null)]}),this.makeIcons(e,i)]))))},makeImages(){return this.makeGroup(this.fileList.map(((e,i)=>this.makeItem(i,[t.createVNode("img",{src:this.getSrc(e)},null),this.makeIcons(e,i)]))))},makeBtn(){const e=t.resolveComponent(this.icon);return t.createVNode("div",{class:"_fc-upload-btn",onClick:()=>this.showModel(),key:7},[t.createVNode(t.resolveComponent("ElIcon"),null,{default:()=>[t.createVNode(e,null,null)]})])},handleClick(e){if(this.onHandle)return this.onHandle(e);this.previewImage=this.getSrc(e),this.previewVisible=!0},handleRemove(e){this.disabled||!1!==this.onBeforeRemove(e)&&(this.fileList.splice(this.fileList.indexOf(e),1),this.input(),this.onRemove(e))},getSrc(e){return this.srcKey?e[this.srcKey]:e},frameLoad(e){this.onLoad(e);try{!0===this.helper&&(e.form_create_helper={api:this.formCreateInject.api,close:e=>{this.valid(e),this.closeModel()},set:(e,t)=>{this.valid(e),!this.disabled&&this.$emit("update:modelValue",t)},get:e=>(this.valid(e),this.modelValue),onOk:e=>this.bus.$on("$ok",e),onClose:e=>this.bus.$on("$close",e)})}catch(e){console.error(e)}},makeFooter(){const{okBtnText:e,closeBtnText:i,closeBtn:r,okBtn:n,footer:o}=this.$props;if(o)return t.createVNode("div",null,[r?t.createVNode(t.resolveComponent("ElButton"),{onClick:()=>!1!==this.onCancel()&&(this.frameVisible=!1)},v(i)?i:{default:()=>[i]}):null,n?t.createVNode(t.resolveComponent("ElButton"),{type:"primary",onClick:()=>!1!==this.onOk()&&this.closeModel()},v(e)?e:{default:()=>[e]}):null])}},render(){const e=this.type;let i;i="input"===e?this.makeInput():"image"===e?this.makeImages():this.makeFiles();const{width:r="30%",height:n,src:o,title:s,modalTitle:a}=this.$props;return t.nextTick((()=>{this.$refs.frame&&this.frameLoad(this.$refs.frame.contentWindow||{})})),t.createVNode("div",{class:{"_fc-frame":!0,"_fc-disabled":this.disabled}},[i,t.createVNode(t.resolveComponent("ElDialog"),{appendToBody:!0,modal:this.previewMask,title:a,modelValue:this.previewVisible,onClose:this.handleCancel},{default:()=>[t.createVNode("img",{style:"width: 100%",src:this.previewImage},null)]}),t.createVNode(t.resolveComponent("ElDialog"),t.mergeProps({appendToBody:!0},{width:r,title:s,...this.modal},{modelValue:this.frameVisible,onClose:()=>this.closeModel(!0)}),{default:()=>[this.frameVisible||!this.reload?t.createVNode("iframe",{ref:"frame",src:o,frameBorder:"0",style:{height:n,border:"0 none",width:"100%"}},null):null],footer:()=>this.makeFooter()})])},beforeMount(){const{name:e,field:t,api:i}=this.formCreateInject;e&&i.on("fc:closeModal:"+e,this.close),t&&i.on("fc:closeModal:"+t,this.close)},beforeUnmount(){const{name:e,field:t,api:i}=this.formCreateInject;e&&i.off("fc:closeModal:"+e,this.close),t&&i.off("fc:closeModal:"+t,this.close)}});var b=t.defineComponent({name:"fcRadio",inheritAttrs:!1,props:{formCreateInject:Object,modelValue:{type:[String,Number,Boolean],default:""},options:Array,type:String,input:Boolean,inputValue:String},emits:["update:modelValue","fc.el"],setup(e,i){const r=t.toRef(e.formCreateInject,"options",[]),n=t.toRef(e,"options"),o=t.toRef(e,"modelValue"),s=t.toRef(e,"inputValue",""),a=t.ref(s.value),l=t.toRef(e,"input",!1);t.watch(s,(e=>{l.value?d(e):a.value=e}));const c=t.computed((()=>{let e=r.value||[];return n.value&&(e=n.value||[]),Array.isArray(e)?e:[]}));t.watch(o,(e=>{let t=!1;!s.value&&null!=e&&l.value&&(t=-1===c.value.map((e=>e.value)).indexOf(e)),t&&(a.value=e)}),{immediate:!0});const u=e=>{i.emit("update:modelValue",e)},d=e=>{const t=a.value;a.value=e,o.value===t&&u(e)};return{options:c,value:o,onInput:u,updateCustomValue:d,customValue:a,makeInput(e){if(l.value)return t.createVNode(e,{checked:!1,value:a.value||void 0,label:a.value||void 0},{default:()=>[t.createVNode(t.resolveComponent("ElInput"),{size:"small",modelValue:a.value,"onUpdate:modelValue":d},null)]})}}},render(){var e,r;const n="button"===this.type?"ElRadioButton":"ElRadio",o=t.resolveComponent(n);return t.createVNode(t.resolveComponent("ElRadioGroup"),t.mergeProps(this.$attrs,{modelValue:this.value,"onUpdate:modelValue":this.onInput,ref:"el"}),{default:()=>[this.options.map(((e,i)=>{const r={...e},s=r.value,a=r.label;return delete r.value,delete r.label,t.createVNode(o,t.mergeProps(r,{label:s,value:s,key:n+i+"-"+s}),{default:()=>[a||s||""]})})),null===(e=(r=this.$slots).default)||void 0===e?void 0:e.call(r),this.makeInput(o)],...i(this.$slots,["default"])})},mounted(){this.$emit("fc.el",this.$refs.el)}});const $={type:(e,t)=>Object.prototype.toString.call(e)==="[object "+t+"]",Undef:e=>null==e,Element:e=>"object"==typeof e&&null!==e&&1===e.nodeType&&!$.Object(e),trueArray:e=>Array.isArray(e)&&e.length>0,Function(e){const t=this.getType(e);return"Function"===t||"AsyncFunction"===t},getType(e){const t=Object.prototype.toString.call(e);return/^\[object (.*)\]$/.exec(t)[1]},empty:e=>null==e||(!(!Array.isArray(e)||!Array.isArray(e)||e.length)||"string"==typeof e&&!e)};function _(e,t){return{}.hasOwnProperty.call(e,t)}["Date","Object","String","Boolean","Array","Number"].forEach((e=>{$[e]=function(t){return $.type(t,e)}}));var x=t.defineComponent({name:"fcSelect",inheritAttrs:!1,props:{formCreateInject:Object,modelValue:{type:[Array,String,Number,Boolean,Object],default:void 0},type:String},emits:["update:modelValue","fc.el"],setup(e){const i=t.toRef(e.formCreateInject,"options",[]);return{options:()=>Array.isArray(i.value)?i.value:[],value:t.toRef(e,"modelValue")}},render(){var e,r;const n=(e,i)=>t.createVNode(t.resolveComponent("ElOption"),t.mergeProps(e,{key:i+"-"+e.value}),null),o=this.options();return t.createVNode(t.resolveComponent("ElSelect"),t.mergeProps(this.$attrs,{modelValue:this.value,"onUpdate:modelValue":e=>this.$emit("update:modelValue",e),ref:"el"}),{default:()=>[o.map(((e,i)=>_(e||"","options")?((e,i)=>t.createVNode(t.resolveComponent("ElOptionGroup"),{label:e.label,key:i+"-"+e.label},{default:()=>[$.trueArray(e.options)&&e.options.map(((e,t)=>n(e,t)))]}))(e,i):n(e,i))),null===(e=(r=this.$slots).default)||void 0===e?void 0:e.call(r)],...i(this.$slots,["default"])})},mounted(){this.$emit("fc.el",this.$refs.el)}});var w=t.defineComponent({name:"fcTree",inheritAttrs:!1,formCreateParser:{mergeProp(e){const t=e.prop.props;t.nodeKey||(t.nodeKey="id"),t.props||(t.props={label:"title"})}},props:{type:String,modelValue:{type:[Array,String,Number],default:()=>[]}},emits:["update:modelValue","fc.el"],watch:{modelValue(){this.setValue()}},methods:{updateValue(){if(!this.$refs.tree)return;let e;e="selected"===this.type?this.$refs.tree.getCurrentKey():this.$refs.tree.getCheckedKeys(),this.$emit("update:modelValue",e)},setValue(){if(!this.$refs.tree)return;"selected"===this.type?this.$refs.tree.setCurrentKey(this.modelValue):this.$refs.tree.setCheckedKeys(r(this.modelValue))}},render(){return t.createVNode(t.resolveComponent("ElTree"),t.mergeProps(this.$attrs,{ref:"tree",onCheck:this.updateValue,onNodeClick:this.updateValue}),this.$slots)},mounted(){this.setValue(),this.$emit("fc.el",this.$refs.tree)}});s("._fc-upload{width:100%}._fc-exceed .el-upload{display:none}.el-upload-list.is-disabled .el-upload{cursor:not-allowed!important}");var k={name:"IconUpload"};const C={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"};function V(e,t){return"object"==typeof e?e:{url:e,is_string:!0,name:S(e),uid:t}}function O(e){return{...e,file:e,value:e}}function S(e){return(""+e).split("/").pop()}k.render=function(e,i,r,n,o,s){return t.openBlock(),t.createElementBlock("svg",C,i[0]||(i[0]=[t.createElementVNode("path",{fill:"currentColor",d:"M160 832h704a32 32 0 110 64H160a32 32 0 110-64zm384-578.304V704h-64V247.296L237.248 490.048 192 444.8 508.8 128l316.8 316.8-45.312 45.248L544 253.696z"},null,-1)]))};var E=t.defineComponent({name:"fcUpload",inheritAttrs:!1,formCreateParser:{toFormValue:e=>r(e),toValue:(e,t)=>1===t.prop.props.limit?e[0]||"":e},props:{previewMask:void 0,onPreview:Function,modalTitle:String,listType:String,modelValue:[Array,String,Object]},emits:["update:modelValue","change","remove","fc.el"],data:()=>({previewVisible:!1,previewImage:"",fileList:[]}),created(){this.fileList=r(this.modelValue).map(V).map(O)},watch:{modelValue(e){this.fileList=r(e).map(V).map(O)}},methods:{handlePreview(e){this.onPreview?this.onPreview(...arguments):"text"===this.listType?window.open(e.url):(this.previewImage=e.url,this.previewVisible=!0)},update(e){let t=e.map((e=>e.is_string?e.url:e.value||e.url)).filter((e=>void 0!==e));this.$emit("update:modelValue",t)},handleCancel(){this.previewVisible=!1},handleChange(e,t){this.$emit("change",...arguments),"success"===e.status&&this.update(t)},handleRemove(e,t){this.$emit("remove",...arguments),this.update(t)}},render(){var e,n;const o=r(this.modelValue).length;return t.createVNode("div",{class:"_fc-upload"},[t.createVNode(t.resolveComponent("ElUpload"),t.mergeProps({key:o},this.$attrs,{listType:this.listType||"picture-card",class:{"_fc-exceed":!!this.$attrs.limit&&this.$attrs.limit<=o},onPreview:this.handlePreview,onChange:this.handleChange,onRemove:this.handleRemove,fileList:this.fileList,ref:"upload"}),{default:()=>[(null===(e=(n=this.$slots).default)||void 0===e?void 0:e.call(n))||(-1===["text","picture"].indexOf(this.listType)?t.createVNode(t.resolveComponent("ElIcon"),null,{default:()=>[t.createVNode(k,null,null)]}):t.createVNode(t.resolveComponent("ElButton"),{type:"primary"},{default:()=>[t.createTextVNode("点击上传")]}))],...i(this.$slots,["default"])}),t.createVNode(t.resolveComponent("ElDialog"),{appendToBody:!0,modal:this.previewMask,title:this.modalTitle,modelValue:this.previewVisible,onClose:this.handleCancel},{default:()=>[t.createVNode("img",{style:"width: 100%",src:this.previewImage},null)]})])},mounted(){this.$emit("fc.el",this.$refs.upload)}});function R(e,t,i){e[t]=i}function F(e,t){delete e[t]}function j(e,t={},i){let r=!1;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let o=t[n];if((r=Array.isArray(o))||$.Object(o)){let t=void 0===e[n];if(r)r=!1,t&&R(e,n,[]);else if(o._clone&&void 0!==i){if(!i){R(e,n,o._clone());continue}o=o.getRule(),t&&R(e,n,{})}else t&&R(e,n,{});e[n]=j(e[n],o,i)}else R(e,n,o),$.Undef(o)||($.Undef(o.__json)||(e[n].__json=o.__json),$.Undef(o.__origin)||(e[n].__origin=o.__origin))}return void 0!==i&&Array.isArray(e)?e.filter((e=>!e||!e.__ctrl)):e}function D(e){return j({},{value:e}).value}const A=Object.assign||function(e){for(let t,i=1;i<arguments.length;i++)for(let r in t=arguments[i],t)Object.prototype.hasOwnProperty.call(t,r)&&R(e,r,t[r]);return e};function P(){return A.apply(this,arguments)}function N(e){return"object"!=typeof e||null===e?e:e instanceof Array?[...e]:{...e}}s('._fc-group{display:flex;flex-direction:column;justify-content:center;min-height:38px;width:100%}._fc-group-disabled ._fc-group-add,._fc-group-disabled ._fc-group-btn{cursor:not-allowed}._fc-group-handle{background-color:#fff;border:1px dashed #d9d9d9;border-radius:15px;bottom:-15px;display:flex;flex-direction:row;padding:3px 8px;position:absolute;right:30px}._fc-group-btn{cursor:pointer}._fc-group-idx{align-items:center;background:#eee;border-radius:15px;bottom:-15px;display:flex;font-weight:700;height:30px;justify-content:center;left:10px;position:absolute;width:30px}._fc-group-handle ._fc-group-btn+._fc-group-btn{margin-left:7px}._fc-group-container{border:1px dashed #d9d9d9;border-radius:5px;display:flex;flex-direction:column;margin:5px 5px 25px;padding:20px 20px 25px;position:relative}._fc-group-arrow{height:20px;position:relative;width:20px}._fc-group-arrow:before{border-left:2px solid #999;border-top:2px solid #999;content:"";height:9px;left:5px;position:absolute;top:8px;transform:rotate(45deg);width:9px}._fc-group-arrow._fc-group-down{transform:rotate(180deg)}._fc-group-plus-minus{cursor:pointer;height:20px;position:relative;width:20px}._fc-group-plus-minus:after,._fc-group-plus-minus:before{background-color:#409eff;content:"";height:2px;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:60%}._fc-group-plus-minus:before{transform:translate(-50%,-50%) rotate(90deg)}._fc-group-plus-minus._fc-group-minus:before{display:none}._fc-group-plus-minus._fc-group-minus:after{background-color:#f56c6c}._fc-group-add{border:1px solid rgba(64,158,255,.5);border-radius:15px;cursor:pointer;height:25px;width:25px}._fc-group-add._fc-group-plus-minus:after,._fc-group-add._fc-group-plus-minus:before{width:50%}');var I=t.defineComponent({name:"fcGroup",props:{field:String,rule:Array,expand:Number,options:Object,button:{type:Boolean,default:!0},max:{type:Number,default:0},min:{type:Number,default:0},modelValue:{type:Array,default:()=>[]},defaultValue:Object,sortBtn:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0},onBeforeRemove:{type:Function,default:()=>{}},onBeforeAdd:{type:Function,default:()=>{}},formCreateInject:Object,parse:Function},data(){return{len:0,cacheRule:{},cacheValue:{},sort:[],form:t.markRaw(this.formCreateInject.form.$form())}},emits:["update:modelValue","change","itemMounted","remove","add"],watch:{rule:{handler(e,t){Object.keys(this.cacheRule).forEach((i=>{const r=this.cacheRule[i];if(r.$f){const i=r.$f.formData();if(e===t)r.$f.deferSyncValue((()=>{j(r.rule,e),r.$f.setValue(i)}),!0);else{const t=r.$f.formData();r.$f.once("reloading",(()=>{r.$f.setValue(t)})),r.rule=D(e)}}}))},deep:!0},expand(e){let t=e-this.modelValue.length;t>0&&this.expandRule(t)},modelValue:{handler(e){e=e||[];let t=this.sort,i=t.length,r=i-e.length;if(r<0){for(let t=r;t<0;t++)this.addRule(e.length+t,!0);for(let r=0;r<i;r++)this.setValue(t[r],e[r])}else{if(r>0)for(let e=0;e<r;e++)this.removeRule(t[i-e-1]);e.forEach(((i,r)=>{this.setValue(t[r],e[r])}))}},deep:!0}},methods:{_value(e){return e&&_(e,this.field)?e[this.field]:e},cache(e,t){this.cacheValue[e]=JSON.stringify(t)},input(e){this.$emit("update:modelValue",e),this.$emit("change",e)},formData(e,t){const i=this.cacheRule,r=this.sort;if(r.filter((e=>i[e].$f)).length!==r.length)return;const n=r.map((i=>{const r=e===i?t:{...this.cacheRule[i].$f.form},n=this.field?r[this.field]||null:r;return this.cache(i,n),n}));this.input(n)},setValue(e,t){const i=this.field;i&&(t={[i]:this._value(t)}),this.cacheValue[e]!==JSON.stringify(i?t[i]:t)&&this.cache(e,t)},addRule(e,i){const r=this.formCreateInject.form.copyRules(this.rule||[]),n=this.options?{...this.options}:{submitBtn:!1,resetBtn:!1};if(this.defaultValue){n.formData||(n.formData={});const e=D(this.defaultValue);P(n.formData,this.field?{[this.field]:e}:e)}this.parse&&this.parse({rule:r,options:n,index:this.sort.length}),this.cacheRule[++this.len]={rule:r,options:n},i&&t.nextTick((()=>this.$emit("add",r,Object.keys(this.cacheRule).length-1)))},add$f(e,i,r){this.cacheRule[i].$f=r,t.nextTick((()=>{this.$emit("itemMounted",r,Object.keys(this.cacheRule).indexOf(i))}))},removeRule(e,i){const r=Object.keys(this.cacheRule).indexOf(e);delete this.cacheRule[e],delete this.cacheValue[e],i&&t.nextTick((()=>this.$emit("remove",r)))},add(e){if(this.disabled||!1===this.onBeforeAdd(this.modelValue))return;const t=[...this.modelValue];t.push(this.defaultValue?D(this.defaultValue):this.field?null:{}),this.input(t)},del(e,t){if(this.disabled||!1===this.onBeforeRemove(this.modelValue,e))return;this.removeRule(t,!0);const i=[...this.modelValue];i.splice(e,1),this.input(i)},addIcon(e){return t.createVNode("div",{class:"_fc-group-btn _fc-group-plus-minus",onClick:this.add},null)},delIcon(e,i){return t.createVNode("div",{class:"_fc-group-btn _fc-group-plus-minus _fc-group-minus",onClick:()=>this.del(e,i)},null)},sortUpIcon(e){return t.createVNode("div",{class:"_fc-group-btn _fc-group-arrow _fc-group-up",onClick:()=>this.changeSort(e,-1)},null)},sortDownIcon(e){return t.createVNode("div",{class:"_fc-group-btn _fc-group-arrow _fc-group-down",onClick:()=>this.changeSort(e,1)},null)},changeSort(e,t){const i=this.sort[e];this.sort[e]=this.sort[e+t],this.sort[e+t]=i,this.formCreateInject.subForm(this.sort.map((e=>this.cacheRule[e].$f))),this.formData(0)},makeIcon(e,t,i){if(this.$slots.button)return this.$slots.button({total:e,index:t,vm:this,key:i,del:()=>this.del(t,i),add:this.add});const r=[];return(!this.max||e<this.max)&&e===t+1&&r.push(this.addIcon(i)),e>this.min&&r.push(this.delIcon(t,i)),this.sortBtn&&t&&r.push(this.sortUpIcon(t)),this.sortBtn&&t!==e-1&&r.push(this.sortDownIcon(t)),r},emitEvent(e,t,i,r){this.$emit(e,...t,this.cacheRule[r].$f,i)},expandRule(e){for(let t=0;t<e;t++)this.addRule(t)}},created(){t.watch((()=>({...this.cacheRule})),(e=>{this.sort=Object.keys(e)}),{immediate:!0});const e=(this.expand||0)-this.modelValue.length;for(let e=0;e<this.modelValue.length;e++)this.addRule(e);e>0&&this.expandRule(e)},render(){const e=this.sort,i=this.button,r=this.form,n=this.disabled,o=0===e.length?this.$slots.default?this.$slots.default({vm:this,add:this.add}):t.createVNode("div",{key:"a_def",class:"_fc-group-plus-minus _fc-group-add fc-clock",onClick:this.add},null):e.map(((o,s)=>{const{rule:a,options:l}=this.cacheRule[o],c=i&&!n?this.makeIcon(e.length,s,o):[];return t.createVNode("div",{class:"_fc-group-container",key:o},[t.createVNode(r,t.mergeProps({key:o},{disabled:n,"onUpdate:modelValue":e=>this.formData(o,e),"onEmit-event":(e,...t)=>this.emitEvent(e,t,s,o),"onUpdate:api":e=>this.add$f(s,o,e),inFor:!0,modelValue:this.field?{[this.field]:this._value(this.modelValue[s])}:this.modelValue[s],rule:a,option:l,extendOption:!0}),null),t.createVNode("div",{class:"_fc-group-idx"},[s+1]),c.length?t.createVNode("div",{class:"_fc-group-handle fc-clock"},[c]):null])}));return t.createVNode("div",{key:"con",class:"_fc-group "+(n?"_fc-group-disabled":"")},[o])}});var B=t.defineComponent({name:"fcSubForm",props:{rule:Array,options:{type:Object,default:()=>t.reactive({submitBtn:!1,resetBtn:!1})},modelValue:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0},formCreateInject:Object},data(){return{cacheValue:{},subApi:{},form:t.markRaw(this.formCreateInject.form.$form())}},emits:["fc:subform","update:modelValue","change","itemMounted"],watch:{modelValue(e){this.setValue(e)}},methods:{formData(e){this.cacheValue=JSON.stringify(e),this.$emit("update:modelValue",e),this.$emit("change",e)},setValue(e){const t=JSON.stringify(e);this.cacheValue!==t&&(this.cacheValue=t,this.subApi.coverValue(e||{}))},add$f(e){this.subApi=e,t.nextTick((()=>{this.$emit("itemMounted",e)}))}},render(){const e=this.form;return t.createVNode(e,{disabled:this.disabled,"onUpdate:modelValue":this.formData,modelValue:this.modelValue,"onEmit-event":this.$emit,"onUpdate:api":this.add$f,rule:this.rule,option:this.options,extendOption:!0},null)}}),T={name:"IconWarning"};const L={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"};T.render=function(e,i,r,n,o,s){return t.openBlock(),t.createElementBlock("svg",L,i[0]||(i[0]=[t.createElementVNode("path",{fill:"currentColor",d:"M512 64a448 448 0 110 896 448 448 0 010-896zm0 832a384 384 0 000-768 384 384 0 000 768zm48-176a48 48 0 11-96 0 48 48 0 0196 0zm-48-464a32 32 0 0132 32v288a32 32 0 01-64 0V288a32 32 0 0132-32z"},null,-1)]))};var M=[n,y,b,x,w,E,I,B,T];function H(e,t){var i=null;return function(...r){null!==i&&clearTimeout(i),i=setTimeout((()=>e.call(this,...r)),t)}}function U(e){let t=e.replace(/([A-Z])/g,"-$1").toLocaleLowerCase();return 0===t.indexOf("-")&&(t=t.substr(1)),t}const z=(e,t)=>{if(e&&e!==t)return e.props.formCreateInject?e.props.formCreateInject:e.parent?z(e.parent,t):void 0};function Y(e,i,n){return t.defineComponent({name:"FormCreate"+(e.isMobile?"Mobile":""),components:i,directives:n,props:{rule:{type:Array,required:!0,default:()=>[]},option:{type:Object,default:()=>({})},extendOption:Boolean,driver:[String,Object],modelValue:Object,disabled:{type:Boolean,default:void 0},preview:{type:Boolean,default:void 0},index:[String,Number],api:Object,locale:[String,Object],name:String,subForm:{type:Boolean,default:!0},inFor:Boolean},emits:["update:api","update:modelValue","mounted","submit","reset","change","emit-event","control","remove-rule","remove-field","sync","reload","repeat-field","update","validate-field-fail","validate-fail","created"],render(){return this.fc.render()},setup(i){const n=t.getCurrentInstance();t.provide("parentFC",n);const o=t.inject("parentFC",null);let s=o;if(o)for(;s.setupState.parent;)s=s.setupState.parent;else s=n;const{rule:a,modelValue:l,subForm:c,inFor:u}=t.toRefs(i),d=t.reactive({ctxInject:{},destroyed:!1,isShow:!0,unique:1,renderRule:[...a.value||[]],updateValue:JSON.stringify(l.value||{})}),h=new e(n),p=h.api(),f=u.value,m=()=>{const e=z(n,o);if(e)if(f){const t=r(e.getSubForm()),i=t.indexOf(p);i>-1&&t.splice(i,1)}else e.subForm()};let g=null;t.onBeforeMount((()=>{t.watchEffect((()=>{let e="";const t=i.option&&i.option.globalClass||{};Object.keys(t).forEach((i=>{let r="";t[i].style&&Object.keys(t[i].style).forEach((e=>{r+=U(e)+":"+t[i].style[e]+";"})),t[i].content&&(r+=t[i].content+";"),r&&(e+=`.${i}{${r}}`)})),i.option&&i.option.style&&(e+=i.option.style),g||(g=document.createElement("style"),g.type="text/css",document.head.appendChild(g)),g.innerHTML=e||""}))}));const v=H((()=>{h.bus.$emit("$loadData.$topForm")}),100),y=H((()=>{h.bus.$emit("$loadData.$form")}),100),b=e=>{h.bus.$emit("change-$form."+e)};return t.onMounted((()=>{o&&(p.top.bus.$on("$loadData.$form",v),p.top.bus.$on("change",b)),h.mounted()})),t.onBeforeUnmount((()=>{o&&(p.top.bus.$off("$loadData.$form",v),p.top.bus.$off("change",b)),g&&document.head.removeChild(g),m(),d.destroyed=!0,h.unmount()})),t.onUpdated((()=>{h.updated()})),t.watch(c,(e=>{e?(()=>{if(o){const e=z(n,o);if(e){let t;f?(t=r(e.getSubForm()),t.push(p)):t=p,e.subForm(t)}}})():m()}),{immediate:!0}),t.watch((()=>[...a.value]),(e=>{h.$handle.isBreakWatch()||e.length===d.renderRule.length&&e.every((e=>d.renderRule.indexOf(e)>-1))||(h.$handle.updateAppendData(),h.$handle.reloadRule(a.value),n.setupState.renderRule())})),t.watch((()=>i.option),(()=>{h.initOptions(),p.refresh()}),{deep:!0}),t.watch((()=>[i.disabled,i.preview]),(()=>{p.refresh()})),t.watch(l,(e=>{JSON.stringify(e||{})!==d.updateValue&&(p.config.forceCoverValue?p.coverValue(e||{}):p.setValue(e||{}))}),{deep:!0,flush:"post"}),t.watch((()=>i.index),(()=>{p.coverValue({}),h.$handle.updateAppendData(),t.nextTick((()=>{t.nextTick((()=>{p.clearValidateState()}))}))}),{flush:"sync"}),{fc:t.markRaw(h),parent:o?t.markRaw(o):o,top:t.markRaw(s),fapi:t.markRaw(p),...t.toRefs(d),getGroupInject:()=>z(n,o),refresh(){++d.unique},renderRule(){d.renderRule=[...a.value||[]]},updateValue(e){if(d.destroyed)return;const i=JSON.stringify(e);d.updateValue!==i&&(d.updateValue=i,n.emit("update:modelValue",e),t.nextTick((()=>{y(),o||v()})))}}},created(){const e=t.getCurrentInstance();e.emit("update:api",e.setupState.fapi),e.setupState.fc.init()}})}const q=["props"],J=["class","style","directives"],G=["on","hook"],W=(e,t={},i={})=>{const r=[...q,...i.normal||[]],n=[...J,...i.array||[]],o=[...G,...i.functional||[]],s=i.props||[];return e.reduce(((e,t)=>{for(const i in t)if(e[i])if(s.indexOf(i)>-1)e[i]=W([t[i]],e[i]);else if(r.indexOf(i)>-1)e[i]={...e[i],...t[i]};else if(n.indexOf(i)>-1){const r=e[i]instanceof Array?e[i]:[e[i]],n=t[i]instanceof Array?t[i]:[t[i]];e[i]=[...r,...n]}else if(o.indexOf(i)>-1)for(const r in t[i])if(e[i][r]){const n=e[i][r]instanceof Array?e[i][r]:[e[i][r]],o=t[i][r]instanceof Array?t[i][r]:[t[i][r]];e[i][r]=[...n,...o]}else e[i][r]=t[i][r];else if("hook"===i)for(let r in t[i])e[i][r]?e[i][r]=K(e[i][r],t[i][r]):e[i][r]=t[i][r];else e[i]=t[i];else r.indexOf(i)>-1||o.indexOf(i)>-1||s.indexOf(i)>-1?e[i]={...t[i]}:n.indexOf(i)>-1?e[i]=t[i]instanceof Array?[...t[i]]:"object"==typeof t[i]?{...t[i]}:t[i]:e[i]=t[i];return e}),t)},K=(e,t)=>function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)},X=["type","slot","ignore","emitPrefix","value","name","native","hidden","display","inject","options","emit","link","prefix","suffix","update","sync","optionsTo","key","slotUpdate","computed","preview","component","cache","modelEmit"],Q=["validate","children","control"],Z=["effect","deep"];function ee(){return[...X,...q,...J,...G,...Q,...Z]}function te(e,t,i){return`[form-create ${e}]: ${t}`+(i?"\n\nrule: "+JSON.stringify(i.getRule?i.getRule():i):"")}function ie(e,t){console.error(te("err",e,t))}function re(e){return ne(e.replace(/(-[a-z])/g,(function(e){return e.replace("-","").toLocaleUpperCase()})))}function ne(e){return e.replace(e[0],e[0].toLowerCase())}const oe="[[FORM-CREATE-PREFIX-",se="-FORM-CREATE-SUFFIX]]";function ae(e,t){return JSON.stringify(j(Array.isArray(e)?[]:{},e,!0),(function(e,t){if(!t||!0!==t._isVue){if("function"!=typeof t)return t;if(t.__json)return t.__json;if(t.__origin&&(t=t.__origin),!t.__emit)return oe+t+se}}),t)}function le(e){return new Function("return "+e)()}function ce(e,t){if(e&&$.String(e)&&e.length>4){let i=e.trim(),r=!1;try{if(i.indexOf(se)>0&&0===i.indexOf(oe))i=i.replace(se,"").replace(oe,""),r=!0;else if(0===i.indexOf("$FN:"))i=i.substring(4),r=!0;else if(0===i.indexOf("$EXEC:"))i=i.substring(6),r=!0;else{if(0===i.indexOf("$GLOBAL:")){const t=i.substring(8);return i=function(...e){const i=e[0].api.getGlobalEvent(t);if(i)return i.call(this,...e)},i.__json=e,i.__inject=!0,i}if(0===i.indexOf("$FNX:"))return i=le("function($inject){"+i.substring(5)+"}"),i.__json=e,i.__inject=!0,i;(t||0!==i.indexOf("function ")||"function "===i)&&(t||0!==i.indexOf("function(")||"function("===i)||(r=!0)}if(!r)return e;let n;try{n=le(i)}catch(e){n=le("function "+i)}return n.__json=e,n}catch(e){return void ie(`解析失败:${i}\n\nerr: ${e}`)}}return e}function ue(e,t){return JSON.parse(e,(function(e,i){return $.Undef(i)||!i.indexOf?i:ce(i,t)}))}function de(e,t){return{value:e,enumerable:!1,configurable:!1,writable:!!t}}function he(e,t){return pe([e],t||!1)[0]}function pe(e,t){return j([],[...e],t||!1)}function fe(e,t){return W(Array.isArray(t)?t:[t],e,{array:Q,normal:Z}),e}function me(e){const t=$.Function(e.getRule)?e.getRule():e;return t.type||(t.type="input"),t}function ge(e,t){Object.defineProperties(e,Object.keys(t).reduce(((e,i)=>(e[i]={get:()=>t[i]()},e)),{}))}function ve(e){return e.__fc__||(e.__origin__?e.__origin__.__fc__:null)}function ye(e,t){try{t=e()}catch(e){!function(e){ie(e.toString()),console.error(e)}(e)}return t}function be(){const e={},i=e=>e||"default";return{setSlot(t,r){t=i(t),!r||Array.isArray(r)&&r.length||(e[t]||(e[t]=[]),e[t].push(r))},getSlot(t,r){t=i(t);const n=[];return(e[t]||[]).forEach((e=>{if(Array.isArray(e))n.push(...e);else if($.Function(e)){const t=e(...r||[]);Array.isArray(t)?n.push(...t):n.push(t)}else $.Undef(e)||n.push(e)})),n},getSlots(){const t={};return Object.keys(e).forEach((e=>{t[e]=(...t)=>this.getSlot(e,t)})),t},slotLen:t=>(t=i(t),e[t]?e[t].length:0),mergeBag(e){if(!e)return this;const i=$.Function(e.getSlots)?e.getSlots():e;return Array.isArray(e)||t.isVNode(e)?this.setSlot(void 0,(()=>e)):Object.keys(i).forEach((e=>{this.setSlot(e,i[e])})),this}}}function $e(e){const t={...e.props||{}};return Object.keys(e.on||{}).forEach((i=>{i.indexOf("-")>0&&(i=re(i));const r=`on${n=i,n.replace(n[0],n[0].toLocaleUpperCase())}`;var n;Array.isArray(t[r])?t[r]=[...t[r],e.on[i]]:t[r]?t[r]=[t[r],e.on[i]]:t[r]=e.on[i]})),t.key=e.key,t.ref=e.ref,t.class=e.class,t.id=e.id,t.style=e.style,t.slot&&delete t.slot,t}function _e(e,t){return Object.setPrototypeOf(e,t),e}const xe=(e,t)=>"string"==typeof e?String(t):"number"==typeof e?Number(t):t,we={"==":(e,t)=>JSON.stringify(e)===JSON.stringify(xe(e,t)),"!=":(e,t)=>!we["=="](e,t),">":(e,t)=>e>t,">=":(e,t)=>e>=t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,on:(e,t)=>e&&e.indexOf&&e.indexOf(xe(e[0],t))>-1,notOn:(e,t)=>!we.on(e,t),in:(e,t)=>t&&t.indexOf&&t.indexOf(e)>-1,notIn:(e,t)=>!we.in(e,t),between:(e,t)=>e>t[0]&&e<t[1],notBetween:(e,t)=>e<t[0]||e>t[1],empty:e=>$.empty(e),notEmpty:e=>!$.empty(e),pattern:(e,t)=>new RegExp(t,"g").test(e)};function ke(e,t){return(Array.isArray(t)?t:(t||"").split(".")).forEach((t=>{null!=e&&(e=e[t])})),e}function Ce(e,t){return(i,r,n,o={})=>{const s=new Ve(e,i,r,n,o);return t&&($.Function(t)?t(s):s.props(t)),s}}function Ve(e,t,i,r,n){this._data=P({props:{},on:{},options:[],children:[],hidden:!1,display:!0,value:void 0},{type:e,title:t,field:i,value:r,props:n||{}}),this.event=this.on}function Oe(e){e.forEach((e=>{Ve.prototype[e]=function(t){return fe(this._data,{[e]:arguments.length<2?t:{[t]:arguments[1]}}),this}}))}P(Ve.prototype,{getRule(){return this._data},setProp(e,t){return R(this._data,e,t),this},modelField(e){return this._data.modelField=e,this},_clone(){const e=new this.constructor;return e._data=he(this._data),e}}),Oe(ee());const Se=Ce("");function Ee(e,t,i){let r=Se("",t);return r._data.type=e,r._data.title=i,r}function Re(){return{create:Ee,factory:Ce}}function Fe(e){const t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}function je(e){if("undefined"==typeof XMLHttpRequest)return;const t=new XMLHttpRequest;let i,r=e.action||"";if(e.query){const t=new URLSearchParams(e.query).toString();r.includes("?")?r+=`&${t}`:r+=`?${t}`}t.onerror=function(t){e.onError(t)},t.onload=function(){if(t.status<200||t.status>=300)return e.onError(function(e,t,i){const r=`fail to ${e} ${i.status}'`,n=new Error(r);return n.status=i.status,n.url=e,n}(r,0,t),Fe(t));e.onSuccess(Fe(t))},t.open(e.method||"get",r,!0),e.data&&("json"!==(e.dataType||"").toLowerCase()?(i=new FormData,Object.keys(e.data).map((t=>{i.append(t,e.data[t])}))):(i=JSON.stringify(e.data),t.setRequestHeader("content-type","application/json"))),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);const n=e.headers||{};Object.keys(n).forEach((e=>{null!=n[e]&&t.setRequestHeader(e,n[e])})),t.send(i)}function De(e,t,i){return new Promise(((r,n)=>{(t||je)({...e,onSuccess(t){let n=e=>e;const o=ce(e.parse);$.Function(o)?n=o:o&&$.String(o)&&(n=e=>ke(e,o)),r(n(t,void 0,i))},onError(e){n(e)}})}))}function Ae(e){return D(e)}function Pe(e){return null==e?"":"object"==typeof e?JSON.stringify(e,null,2):String(e)}let Ne=0;function Ie(){const e=370+ ++Ne;return"F"+Math.random().toString(36).substr(3,3)+Number(`${Date.now()}`).toString(36)+e.toString(36)+"c"}function Be(e,t,i){let r,n=e;return(t||"").split(".").forEach((e=>{r&&(n[r]&&"object"==typeof n[r]||(n[r]={}),n=n[r]),r=e})),n[r]=i,n}let Te=1;function Le(e){P(this,{$handle:e,fc:e.fc,vm:e.vm,$manager:e.$manager,vNode:new e.fc.CreateNode(e.vm),id:Te++}),ge(this,{options:()=>e.options,sort:()=>e.sort}),this.initCache(),this.initRender()}!function(e){P(e.prototype,{initCache(){this.clearCacheAll()},clearCache(e){e.rule.cache||(this.cache[e.id]?((!0===this.cache[e.id].use||this.cache[e.id].parent)&&this.$handle.refresh(),this.cache[e.id].parent&&this.clearCache(this.cache[e.id].parent),this.cache[e.id]=null):e.parent&&this.clearCache(e.parent))},clearCacheAll(){this.cache={}},setCache(e,t,i){this.cache[e.id]={vnode:t,use:!1,parent:i,slot:e.rule.slot}},getCache(e){const t=this.cache[e.id];if(t)return t.use=!0,t.vnode}})}(Le),function(e){P(e.prototype,{initRender(){this.cacheConfig={}},getTypeSlot(e){const t=i=>{if(i){let r;return e.rule.field&&(r=i.slots["field-"+U(e.rule.field)]||i.slots["field-"+e.rule.field]),r||(r=i.slots["type-"+U(e.type)]||i.slots["type-"+e.type]),r||t(i.setupState.parent)}};return t(this.vm)},render(){if(!this.vm.setupState.isShow)return;this.$manager.beforeRender();const e=be();return this.sort.forEach((t=>{this.renderSlot(e,this.$handle.ctxs[t])})),this.$manager.render(e)},renderSlot(e,t,i){if(this.isFragment(t)){t.initProp(),this.mergeGlobal(t),t.initNone();const i=this.renderChildren(t.loadChildrenPending(),t),r=i.default;r&&e.setSlot(t.rule.slot,(()=>r())),delete i.default,e.mergeBag(i)}else e.setSlot(t.rule.slot,this.renderCtx(t,i))},mergeGlobal(e){this.$handle.options.global&&(this.cacheConfig[e.trueType]||(this.cacheConfig[e.trueType]=t.computed((()=>{const t=this.$handle.options.global;return fe({},[t["*"],t[e.originType]||t[e.type]||t[e.type]||{}])}))),e.prop=fe({},[this.cacheConfig[e.trueType].value,e.prop]))},setOptions(e){const t=e.loadPending({key:"options",origin:e.prop.options,def:[]});e.prop.options=t,e.prop.optionsTo&&t&&Be(e.prop,e.prop.optionsTo,t)},deepSet(e){const t=e.rule.deep;t&&Object.keys(t).sort(((e,t)=>e.length<t.length?-1:1)).forEach((i=>{Be(e.prop,i,t[i])}))},parseSide:(e,t)=>$.Object(e)?fe({props:{formCreateInject:t.prop.props.formCreateInject}},e):e,renderSides(e,t,i){const r=t[i?"rule":"prop"];return[this.renderRule(this.parseSide(r.prefix,t)),e,this.renderRule(this.parseSide(r.suffix,t))]},renderId(e,t){const i=this.$handle["field"===t?"fieldCtx":"nameCtx"][e];return i?i.map((e=>this.renderCtx(e,e.parent))):void 0},renderCtx(e,t){try{if("hidden"===e.type)return;const i=e.rule;if(!this.cache[e.id]||this.cache[e.id].slot!==i.slot){let r;e.initProp(),this.mergeGlobal(e),e.initNone(),this.$manager.tidyRule(e),this.deepSet(e),this.setOptions(e),this.ctxProp(e);let n=e.prop;n.preview=!!(null!=n.preview?n.preview:this.$handle.preview),n.props.formCreateInject=this.injectProp(e);let o=!1!==n.cache;const s=n.preview;if(n.hidden)return void this.setCache(e,void 0,t);r=(...r)=>{const a={rule:i,prop:n,preview:s,api:this.$handle.api,model:n.model||{},slotValue:r};r.length&&i.slotUpdate&&ye((()=>i.slotUpdate(a)));let l={};const c=e.loadChildrenPending();e.parser.renderChildren?l=e.parser.renderChildren(c,e):!1!==e.parser.loadChildren&&(l=this.renderChildren(c,e));const u=this.getTypeSlot(e);let d;return u?(a.children=l,d=u(a)):d=s?e.parser.preview(N(l),e):e.parser.render(N(l),e),d=this.renderSides(d,e),!e.input&&$.Undef(n.native)||!0===n.native||(this.fc.targetFormDriver("updateWrap",e),d=this.$manager.makeWrap(e,d)),e.none&&(d=Array.isArray(d)?d.map((e=>e&&e.__v_isVNode?this.none(e):e)):this.none(d)),o&&this.setCache(e,(()=>this.stable(d)),t),d},this.setCache(e,r,t)}return(...t)=>{const i=this.getCache(e);if(i)return i(...t);if(this.cache[e.id])return;const r=this.renderCtx(e,e.parent);return r?r():void 0}}catch(e){return void console.error(e)}},none(e){if(e)return e.props.class=this.mergeClass(e.props.class,"fc-none"),e},mergeClass:(e,t)=>Array.isArray(e)?(e.push(t),e):e?[e,t]:t,stable(e){return(Array.isArray(e)?e:[e]).forEach((e=>{e&&e.__v_isVNode&&e.children&&"object"==typeof e.children&&(e.children.$stable=!0,this.stable(e.children))})),e},getModelField(e){return e.prop.modelField||e.parser.modelField||this.fc.modelFields[this.vNode.aliasMap[e.type]]||this.fc.modelFields[e.type]||this.fc.modelFields[e.originType]||"modelValue"},isFragment:e=>"fragment"===e.type||"template"===e.type,injectProp(e){const t=this.vm.setupState;t.ctxInject[e.id]||(t.ctxInject[e.id]={api:this.$handle.api,form:this.fc.create,subForm:t=>{this.$handle.addSubForm(e,t)},getSubForm:()=>this.$handle.subForm[e.id],slots:()=>this.vm.setupState.top.slots,options:[],children:[],preview:!1,id:e.id,field:e.field,rule:e.rule,input:e.input,updateValue:t=>{this.$handle.onUpdateValue(e,t)}});const i=t.ctxInject[e.id];return P(i,{preview:e.prop.preview,options:e.prop.options,children:e.loadChildrenPending()}),i},ctxProp(e){const{ref:t,key:i,rule:r}=e;this.$manager.mergeProp(e),e.parser.mergeProp(e);const n=[{ref:t,key:r.key||`${i}fc`,slot:void 0,on:{vnodeMounted:t=>{t.el.__rule__=e.rule,this.onMounted(e,t.el)},"fc.updateValue":t=>{this.$handle.onUpdateValue(e,t)},"fc.el":t=>{e.exportEl=t,t&&((t.$el||t).__rule__=e.rule)}}}];if(e.input){!0===this.vm.props.disabled&&(e.prop.props.disabled=!0);const t=this.getModelField(e),i={callback:t=>{this.onInput(e,t)},modelField:t,value:this.$handle.getFormData(e)};n.push({on:{[`update:${t}`]:i.callback,...e.prop.modelEmit?{[e.prop.modelEmit]:()=>this.onEmitInput(e)}:{}},props:{[t]:i.value}}),e.prop.model=i}return W(n,e.prop),e.prop},onMounted(e,t){e.el=this.vm.refs[e.ref]||t,e.parser.mounted(e),this.$handle.effect(e,"mounted"),this.$handle.targetHook(e,"mounted")},onInput(e,t){e.prop.modelEmit?this.$handle.onBaseInput(e,t):this.$handle.onInput(e,t)},onEmitInput(e){this.$handle.setValue(e,e.parser.toValue(e.modelValue,e),e.modelValue)},renderChildren(e,i){if(!$.trueArray(e))return{};const r=be();return e.map((n=>{if(n)return $.String(n)?r.setSlot(null,n):n.__fc__?this.renderSlot(r,n.__fc__,i):void(n.type&&t.nextTick((()=>{this.$handle.loadChildren(e,i),this.$handle.refresh()})))})),r.getSlots()},defaultRender(e,t){const i=e.prop;return i.component?"string"==typeof i.component?this.vNode.make(i.component,i,t):this.vNode.makeComponent(i.component,i,t):this.vNode[e.type]?this.vNode[e.type](i,t):this.vNode[e.originType]?this.vNode[e.originType](i,t):this.vNode.make(ne(i.type),i,t)},renderRule(e,t,i){if(!e)return;if($.String(e))return e;let r;if(i)r=e.type;else if(r=e.is,e.type){r=re(e.type);const t=this.vNode.aliasMap[r];t&&(r=re(t))}if(!r)return;const n=be();$.trueArray(e.children)&&e.children.forEach((e=>{e&&n.setSlot(null==e?void 0:e.slot,(()=>this.renderRule(e)))}));const o={...e};return delete o.type,delete o.is,this.vNode.make(r,o,n.mergeBag(t).getSlots())}})}(Le);const Me=["hook:updated","hook:mounted"];function He(e,i,r){const n=Ie(),o=!!i.field;var s;P(this,{id:n,ref:n,wrapRef:n+"fi",rule:i,origin:i.__origin__||i,name:i.name,pending:{},none:!1,watch:[],linkOn:[],root:[],ctrlRule:[],children:[],parent:null,group:i.subRule?this:null,cacheConfig:null,prop:{...i},computed:{},payload:{},refRule:{},input:o,el:void 0,exportEl:void 0,defaultValue:o?D(r):void 0,field:i.field||void 0}),this.updateKey(),s=this,Object.defineProperties(s.origin,{__fc__:de(t.markRaw(s),!0)}),s.rule!==s.origin&&Object.defineProperties(s.rule,{__fc__:de(t.markRaw(s),!0)}),this.update(e,!0)}function Ue(e,t){for(let i=0;i<e.ctrlRule.length;i++){const r=e.ctrlRule[i];if(r.children===t)return r}}function ze(e){return!!e.rule.__ctrl}function Ye(e,t){return"function"==typeof t?""+t:t}P(He.prototype,{getParentGroup(){let e=this.parent;for(;e;){if(e.group)return e;e=e.parent}},loadChildrenPending(){const e=this.rule.children||[];return Array.isArray(e)?e:this.loadPending({key:"children",origin:e,def:[],onLoad:e=>{this.$handle&&this.$handle.loadChildren(e,this)},onUpdate:(e,t)=>{this.$handle&&(e===t?this.$handle.loadChildren(e,this):this.$handle.updateChildren(this,e,t))},onReload:e=>{this.$handle?this.$handle.updateChildren(this,[],e):delete this.pending.children}})},loadPending(e){const{key:t,origin:i,def:r,onLoad:n,onReload:o,onUpdate:s}=e;if(this.pending[t]&&this.pending[t].origin===i)return this.getPending(t,r);delete this.pending[t];let a=i;if($.Function(i)){let e=ye((()=>i({rule:this.rule,api:this.$api,update:e=>{const n=e||r,o=this.getPending(t,r);this.setPending(t,i,n),s&&s(n,o)},reload:()=>{const e=this.getPending(t,r);delete this.pending[t],o&&o(e),this.$api&&this.$api.sync(this.rule)}})));e&&$.Function(e.then)?(e.then((e=>{const o=e||r;this.setPending(t,i,o),n&&n(o),this.$api&&this.$api.sync(this.rule)})).catch((e=>{console.error(e)})),a=r,this.setPending(t,i,a)):(a=e||r,this.setPending(t,i,a),n&&n(a))}return a},getPending(e,t){return this.pending[e]&&this.pending[e].value||t},setPending(e,i,r){this.pending[e]={origin:i,value:t.reactive(r)}},effectData(e){return this.payload[e]||(this.payload[e]={}),this.payload[e]},clearEffectData(e){void 0===e?this.payload={}:delete this.payload[e]},updateKey(e){this.key=Ie(),e&&this.parent&&this.parent.updateKey(e)},updateType(){this.originType=this.rule.type,this.type=re(this.rule.type),this.trueType=this.$handle.getType(this.originType)},setParser(e){this.parser=e,e.init(this)},initProp(){const e={...this.rule};delete e.children,delete e.validate,this.prop=fe({},[e,...Object.keys(this.payload).map((e=>this.payload[e])),this.computed]),this.prop.validate=[...this.refRule.__$validate.value||[],...this.prop.validate||[]]},initNone(){this.none=!($.Undef(this.prop.display)||this.prop.display)},injectValidate(){return this.prop.validate},check(e){return this.vm===e.vm},unwatch(){this.watch.forEach((e=>e())),this.watch=[],this.refRule={}},unlink(){this.linkOn.forEach((e=>e())),this.linkOn=[]},link(){this.unlink(),this.$handle.appendLink(this)},watchTo(){this.$handle.watchCtx(this)},delete(){this.unwatch(),this.unlink(),this.rmCtrl(),this.parent&&this.parent.children.splice(this.parent.children.indexOf(this)>>>0,1),P(this,{deleted:!0,computed:{},parent:null,children:[],cacheConfig:null,none:!1})},rmCtrl(){this.ctrlRule.forEach((e=>e.__fc__&&e.__fc__.rm())),this.ctrlRule=[]},rm(){const e=()=>{let e=this.root.indexOf(this.origin);e>-1&&(this.root.splice(e,1),this.$handle&&this.$handle.refresh())};this.deleted?e():this.$handle.noWatch((()=>{this.$handle.deferSyncValue((()=>{this.rmCtrl(),e(),this.$handle.rmCtx(this),P(this,{root:[]})}),this.input)}))},update(e,t){P(this,{deleted:!1,$handle:e,$render:e.$render,$api:e.api,vm:e.vm,vNode:e.$render.vNode,updated:!1,cacheValue:this.rule.value}),!t&&this.unwatch(),this.watchTo(),this.link(),this.updateType()}});const qe={init(e){},toFormValue:(e,t)=>e,toValue:(e,t)=>e,mounted(e){},render:(e,t)=>t.$handle.fc.renderDriver&&t.$handle.fc.renderDriver.defaultRender?t.$handle.fc.renderDriver.defaultRender(t,e):t.$render.defaultRender(t,e),preview(e,t){return t.$handle.fc.renderDriver&&t.$handle.fc.renderDriver.defaultPreview?t.$handle.fc.renderDriver.defaultPreview(t,e):this.render(e,t)},mergeProp(e){}},Je=["field","value","vm","template","name","config","control","inject","sync","payload","optionsTo","update","slotUpdate","computed","component","cache"];function Ge(e){ge(this,{options:()=>e.options.value||{},bus:()=>e.bus,preview:()=>null!=e.vm.props.preview?e.vm.props.preview:e.options.value.preview||!1}),P(this,{fc:e,vm:e.vm,watching:!1,loading:!1,reloading:!1,noWatchFn:null,deferSyncFn:null,isMounted:!1,formData:t.reactive({}),subRuleData:t.reactive({}),subForm:{},form:t.reactive({}),appendData:{},ignoreFields:[],providers:{},cycleLoad:null,loadedId:1,nextTick:null,changeStatus:!1,pageEnd:!0,nextReload:()=>{this.lifecycle("reload")}}),this.initData(e.rules),this.$manager=new e.manager(this),this.$render=new Le(this),this.api=e.extendApiFn.reduce(((e,t)=>(P(e,ye((()=>t(e,this)),{})),e)),function(e){function i(t){return $.Undef(t)?t=e.fields():Array.isArray(t)||(t=[t]),t}function r(t,r,n){i(t).forEach((t=>{e.getCtxs(t).forEach((t=>{R(t.rule,r,n),e.$render.clearCache(t)}))}))}function n(){const t=e.subForm;return Object.keys(t).reduce(((e,i)=>{const r=t[i];return r?(Array.isArray(r)?e.push(...r):e.push(r),e):e}),[])}const o={get config(){return e.options},set config(t){e.fc.options.value=t},get options(){return e.options},set options(t){e.fc.options.value=t},get form(){return e.form},get rule(){return e.rules},get parent(){return e.vm.setupState.parent&&e.vm.setupState.parent.setupState.fapi},get top(){return o.parent?o.parent.top:o},get children(){return n()},get siblings(){const t=e.vm.setupState.getGroupInject();if(t){const e=t.getSubForm();if(Array.isArray(e))return[...e]}},get index(){const e=o.siblings;if(e){const t=e.indexOf(o);return t>-1?t:void 0}},formData(t){if(null==t){const t={};return Object.keys(e.form).forEach((i=>{-1===e.ignoreFields.indexOf(i)&&(t[i]=Ae(e.form[i]))})),t}return i(t).reduce(((e,t)=>(e[t]=o.getValue(t),e)),{})},getValue(t){const i=e.getFieldCtx(t);return i?Ae(i.rule.value):!1!==e.options.appendValue&&_(e.appendData,t)?Ae(e.appendData[t]):void 0},coverValue(t){const i={...t||{}};e.deferSyncValue((()=>{e.appendData={},o.fields().forEach((r=>{const n=e.fieldCtx[r];if(n){const e=_(t,r);n.forEach((i=>{i.rule.value=e?t[r]:void 0})),delete i[r]}})),P(e.appendData,i)}),!0)},setValue(t){let i=t;arguments.length>=2&&(i={[t]:arguments[1]}),e.deferSyncValue((()=>{Object.keys(i).forEach((t=>{const r=e.fieldCtx[t];if(!r)return e.appendData[t]=i[t];r.forEach((e=>{e.rule.value=i[t]}))}))}),!0)},removeField(t){const i=e.getCtx(t);return e.deferSyncValue((()=>{e.getCtxs(t).forEach((e=>{e.rm()}))}),!0),i?i.origin:void 0},removeRule(e){const t=e&&ve(e);if(t)return t.rm(),t.origin},fields:()=>e.fields(),append:(t,i,r)=>{let n,o=e.sort.length-1;const s=e.getCtx(i);if(s)if(r){if(n=s.getPending("children",s.rule.children),!Array.isArray(n))return;o=s.rule.children.length-1}else o=s.root.indexOf(s.origin),n=s.root;else n=e.rules;n.splice(o+1,0,t)},prepend:(t,i,r)=>{let n,o=0;const s=e.getCtx(i);if(s)if(r){if(n=s.getPending("children",s.rule.children),!Array.isArray(n))return}else o=s.root.indexOf(s.origin),n=s.root;else n=e.rules;n.splice(o,0,t)},hidden(t,i){r(i,"hidden",!!t),e.refresh()},hiddenStatus(t){const i=e.getCtx(t);if(i)return!!i.rule.hidden},display(t,i){r(i,"display",!!t),e.refresh()},displayStatus(t){const i=e.getCtx(t);if(i)return!!i.rule.display},disabled(t,r){i(r).forEach((i=>{e.getCtxs(i).forEach((e=>{R(e.rule.props,"disabled",!!t)}))})),e.refresh()},all:t=>Object.keys(e.ctxs).map((i=>{const r=e.ctxs[i];return t?r.origin:r.rule})),model:t=>e.fields().reduce(((i,r)=>{const n=e.fieldCtx[r][0];return i[r]=t?n.origin:n.rule,i}),{}),component:t=>Object.keys(e.nameCtx).reduce(((i,r)=>{const n=e.nameCtx[r].map((e=>t?e.origin:e.rule));return i[r]=1===n.length?n[0]:n,i}),{}),bind:()=>o.form,reload:t=>{e.reloadRule(t)},updateOptions(t){e.fc.updateOptions(t),o.refresh()},onSubmit(e){o.updateOptions({onSubmit:e})},sync:t=>{if(Array.isArray(t))return void t.forEach((e=>o.sync(e)));let i=$.Object(t)?ve(t):e.getCtxs(t);i&&(i=Array.isArray(i)?i:[i],i.forEach((t=>{if(!t.deleted){const i=e.subForm[t.id];i&&(Array.isArray(i)?i.forEach((e=>{e.refresh()})):i&&i.refresh()),e.$render.clearCache(t)}})),e.refresh())},refresh:()=>{n().forEach((e=>{e.refresh()})),e.$render.clearCacheAll(),e.refresh()},refreshOptions(){e.$manager.updateOptions(e.options),o.refresh()},hideForm:t=>{e.vm.setupState.isShow=!t},changeStatus:()=>e.changeStatus,clearChangeStatus:()=>{e.changeStatus=!1},updateRule(t,i){e.getCtxs(t).forEach((e=>{P(e.rule,i)}))},updateRules(e){Object.keys(e).forEach((t=>{o.updateRule(t,e[t])}))},mergeRule:(t,i)=>{e.getCtxs(t).forEach((e=>{fe(e.rule,i)}))},mergeRules(e){Object.keys(e).forEach((t=>{o.mergeRule(t,e[t])}))},getRule:(t,i)=>{const r=e.getCtx(t);if(r)return i?r.origin:r.rule},getRenderRule:t=>{const i=e.getCtx(t);if(i)return i.prop},getRefRule:t=>{const i=e.getCtxs(t);if(i){const e=i.map((e=>e.rule));return 1===e.length?e[0]:e}},setEffect(t,i,r){const n=e.getCtx(t);n&&i&&("$"===i[0]&&(i=i.substr(1)),_(n.rule,"$"+i)&&R(n.rule,"$"+i,r),_(n.rule,"effect")||(n.rule.effect={}),R(n.rule.effect,i,r))},clearEffectData(t,i){const r=e.getCtx(t);r&&(i&&"$"===i[0]&&(i=i.substr(1)),r.clearEffectData(i),o.sync(t))},updateValidate(e,t,i){i?o.mergeRule(e,{validate:t}):r(e,"validate",t)},updateValidates(e,t){Object.keys(e).forEach((i=>{o.updateValidate(i,e[i],t)}))},refreshValidate(){o.refresh()},resetFields(r){i(r).forEach((t=>{e.getCtxs(t).forEach((t=>{e.$render.clearCache(t),t.rule.value=Ae(t.defaultValue)}))})),t.nextTick((()=>{o.clearValidateState()})),null==r&&($.Function(e.options.onReset)&&ye((()=>e.options.onReset(o))),e.vm.emit("reset",o))},method(e,t){const i=o.el(e);if(!i||!i[t])throw new Error(te("err",`${t} 方法不存在`));return(...e)=>i[t](...e)},exec:(e,t,...i)=>ye((()=>o.method(e,t)(...i))),toJson:e=>ae(o.rule,e),trigger(e,t,...i){const r=o.el(e);r&&r.$emit(t,...i)},el(t){const i=e.getCtx(t);if(i)return i.el||e.vm.refs[i.ref]},closeModal:t=>{e.bus.$emit("fc:closeModal:"+t)},getSubForm(t){const i=e.getCtx(t);return i?e.subForm[i.id]:void 0},getChildrenRuleList(t){const i="object"==typeof t,r=i?ve(t):e.getCtx(t),n=r?r.rule:i?t:o.getRule(t);if(!n)return[];const s=[];var a;return(a=r?r.loadChildrenPending():n.children)&&a.forEach((e=>{"object"==typeof e&&(e.field&&s.push(e),s.push(...o.getChildrenRuleList(e)))})),s},getParentRule:t=>("object"==typeof t?ve(t):e.getCtx(t)).parent.rule,getParentSubRule(t){const i="object"==typeof t?ve(t):e.getCtx(t);if(i){const e=i.getParentGroup();if(e)return e.rule}},getChildrenFormData:e=>o.getChildrenRuleList(e).reduce(((e,t)=>(e[t.field]=Ae(t.value),e)),{}),setChildrenFormData(t,i,r){const n=o.getChildrenRuleList(t);e.deferSyncValue((()=>{n.forEach((e=>{_(i,e.field)?e.value=i[e.field]:r&&(e.value=void 0)}))}))},getGlobalEvent(e){let t=o.options.globalEvent[e];if(t)return"object"==typeof t&&(t=t.handle),ce(t)},getGlobalData:t=>new Promise(((i,r)=>{let n=o.options.globalData[t];n||i(e.fc.loadData[t]),"fetch"===n.type?o.fetch(n).then((e=>{i(e)})).catch(r):i(n.data)})),nextTick(t){e.bus.$once("next-tick",t),e.refresh()},nextRefresh(t){e.nextRefresh(),t&&ye(t)},deferSyncValue(t,i){e.deferSyncValue(t,i)},emit(t,...i){e.vm.emit(t,...i)},bus:e.bus,fetch:t=>new Promise(((i,r)=>{t=D(t),t=e.loadFetchVar(t),e.beforeFetch(t).then((()=>De(t,e.fc.create.fetch,o).then((e=>{ye((()=>t.onSuccess&&t.onSuccess(e))),i(e)})).catch((e=>{ye((()=>t.onError&&t.onError(e))),r(e)}))))})),watchFetch:(t,i,r)=>e.fc.watchLoadData(((n,s)=>{let a=D(t);a=e.loadFetchVar(a,n),e.beforeFetch(a).then((()=>De(a,e.fc.create.fetch,o).then((e=>{ye((()=>a.onSuccess&&a.onSuccess(e))),i&&i(e,s)})).catch((e=>{ye((()=>a.onError&&a.onError(e))),r&&r(e)}))))})),getData:(t,i)=>e.fc.getLoadData(t,i),watchData:t=>e.fc.watchLoadData(((e,i)=>{ye((()=>t(e,i)))})),setData:(t,i,r)=>e.fc.setData(t,i,r),refreshData:t=>e.fc.refreshData(t),t:(t,i)=>e.fc.t(t,i),getLocale:()=>e.fc.getLocale(),helper:{tidyFields:i,props:r}};return["on","once","off"].forEach((t=>{o[t]=function(...i){e.bus[`$${t}`](...i)}})),o.changeValue=o.changeField=o.setValue,o}(this))}P(Ge.prototype,{initData(e){P(this,{ctxs:{},fieldCtx:{},nameCtx:{},sort:[],rules:e})},init(){this.updateAppendData(),this.useProvider(),this.usePage(),this.loadRule(),this.$manager.__init(),this.lifecycle("created")},updateAppendData(){this.appendData={...this.options.formData||{},...this.fc.vm.props.modelValue||{},...this.appendData}},isBreakWatch(){return this.loading||this.noWatchFn||this.reloading},beforeFetch(e){return new Promise((t=>{const i=this.options.beforeFetch&&ye((()=>this.options.beforeFetch(e,{api:this.api})));i&&$.Function(i.then)?i.then(t):t()}))}}),function(e){P(e.prototype,{parseInjectEvent(e,t){const i=e.inject||this.options.injectEvent;return this.parseEventLst(e,t,i)},parseEventLst(e,t,i,r){return Object.keys(t).forEach((n=>{const o=this.parseEvent(e,t[n],i,r);o&&(t[n]=o)})),t},parseEvent(e,t,i,r){if($.Function(t)&&(!1!==i&&!$.Undef(i)||t.__inject))return this.inject(e,t,i);if(!r&&Array.isArray(t)&&t[0]&&($.String(t[0])||$.Function(t[0])))return this.parseEventLst(e,t,i,!0);if($.String(t)){const r=ce(t);if(r&&t!==r)return r.__inject?this.parseEvent(e,r,i,!0):r}},parseEmit(e){let t={},i=e.rule,{emitPrefix:r,field:n,name:o,inject:s}=i,a=i.emit||[];return $.trueArray(a)&&a.forEach((e=>{if(!e)return;let a,l=r||n||o;if($.Object(e)&&(a=e.inject,l=(e=e.name).prefix||l),l){const r=U(`${l}-${e}`),n=(...e)=>{this.vm.emitsOptions&&(this.vm.emitsOptions[r]=null),this.vm.emit(r,...e),this.vm.emit("emit-event",r,...e),this.bus.$emit(r,...e)};if(n.__emit=!0,a||!1!==s){let r=a||s||this.options.injectEvent;t[e]=$.Undef(r)?n:this.inject(i,n,r)}else t[e]=n}})),e.computed.on=t,t},getInjectData(e,t){const i=e.__fc__&&e.__fc__.$api,r=e.__fc__&&e.__fc__.$handle.vm||this.vm,{option:n,rule:o}=r.props;return{$f:i||this.api,api:i||this.api,rule:o,self:e.__origin__,option:n,inject:t}},inject(e,t,i){if(t.__origin){if(this.watching&&!this.loading)return t;t=t.__origin}const r=this,n=function(...n){const o=r.getInjectData(e,i);return o.args=[...n],n.unshift(o),t.apply(this,n)};return n.__origin=t,n.__json=t.__json,n},loadStrVar(e,t){if(e&&"string"==typeof e&&e.indexOf("{{")>-1&&e.indexOf("}}")>-1){const i=e,r=function(e){const t=/{{\s*(.*?)\s*}}/g;let i;const r={};for(;null!==(i=t.exec(e));)i[1]&&(r[i[1]]=!0);return Object.keys(r)}(e);let n;if(r.forEach((i=>{const r=i.split("||"),o=r[0].trim();if(o){const s=(r[1]||"").trim(),a=t?t(o,s):this.fc.getLoadData(o,s);n=a,e=e.replaceAll(`{{${i}}}`,null==a?"":a)}})),1===r.length&&i===`{{${r[0]}}}`)return n}return e},loadFetchVar(e,t){const i=e=>this.loadStrVar(e,t);if(e.action=i(e.action),e.headers){const t={};Object.keys(e.headers).forEach((r=>{t[i(r)]=i(e.headers[r])})),e.headers=t}if(e.data){const t={};Object.keys(e.data).forEach((r=>{t[i(r)]=i(e.data[r])})),e.data=t}return e}})}(Ge),function(e){P(e.prototype,{usePage(){const e=this.options.page;if(!e)return;let t=25,i=(r=this.rules).length<31?31:Math.ceil(r.length/3);var r;$.Object(e)&&(e.first&&(t=parseInt(e.first,10)||t),e.limit&&(i=parseInt(e.limit,10)||i)),P(this,{first:t,limit:i,pageEnd:this.rules.length<=t}),this.bus.$on("page-end",(()=>this.vm.emit("page-end",this.api))),this.pageLoad()},pageLoad(){const e=()=>{this.pageEnd?(this.bus.$off(Me,e),this.bus.$emit("page-end")):(this.first+=this.limit,this.pageEnd=this.rules.length<=this.first,this.loadRule(),this.refresh())};this.bus.$on(Me,e)}})}(Ge),function(e){P(e.prototype,{clearNextTick(){this.nextTick&&clearTimeout(this.nextTick),this.nextTick=null},bindNextTick(e){this.clearNextTick(),this.nextTick=setTimeout((()=>{e(),this.nextTick=null}),10)},render(){return++this.loadedId,this.vm.setupState.unique>0?this.$render.render():(this.vm.setupState.unique=1,[])}})}(Ge),function(e){P(e.prototype,{nextRefresh(e){const i=this.loadedId;t.nextTick((()=>{i===this.loadedId&&(e?e():this.refresh())}))},parseRule(e){const t=me(e);return Object.defineProperties(t,{__origin__:de(e,!0)}),function(e){const t={props:{},on:{},options:[],children:[],hidden:!1,display:!0,value:void 0};Object.keys(t).forEach((i=>{_(e,i)||(e[i]=t[i])}))}(t),this.appendValue(t),[t,t.prefix,t.suffix].forEach((e=>{e&&this.loadFn(e,t)})),this.loadCtrl(t),t.update&&(t.update=ce(t.update)),t},loadFn(e,t){["on","props","deep"].forEach((i=>{e[i]&&this.parseInjectEvent(t,e[i])}))},loadCtrl(e){e.control&&e.control.forEach((e=>{e.handle&&(e.handle=ce(e.handle))}))},syncProp(e){const t=e.rule;$.trueArray(t.sync)&&W([{on:t.sync.reduce(((e,i)=>(e[`update:${i}`]=e=>{t.props[i]=e,this.vm.emit("sync",i,e,t,this.fapi)},e)),{})}],e.computed)},loadRule(){this.cycleLoad=!1,this.loading=!0,this.pageEnd&&this.bus.$emit("load-start"),this.deferSyncValue((()=>{if(this._loadRule(this.rules),this.loading=!1,this.cycleLoad&&this.pageEnd)return this.loadRule();this.syncForm(),this.pageEnd&&this.bus.$emit("load-end"),this.vm.setupState.renderRule()}))},loadChildren(e,t){if(this.cycleLoad=!1,this.loading=!0,this.bus.$emit("load-start"),this._loadRule(e,t),this.loading=!1,this.cycleLoad)return this.loadRule();this.syncForm(),this.bus.$emit("load-end"),this.$render.clearCache(t)},_loadRule(e,t){const i=t=>{let r=e[t-1];if(!r||!r.__fc__)return t>0?i(t-1):-1;let n=this.sort.indexOf(r.__fc__.id);return n>-1?n:i(t-1)},r=(e,t)=>{$.trueArray(e)&&this._loadRule(e,t)},n=e.map(((n,o)=>{if(t&&!$.Object(n))return;if(!this.pageEnd&&!t&&o>=this.first)return;if(n.__fc__&&n.__fc__.root===e&&this.ctxs[n.__fc__.id])return r(n.__fc__.loadChildrenPending(),n.__fc__),n.__fc__;let s=me(n);const a=()=>!(!s.field||!this.fieldCtx[s.field]||this.fieldCtx[s.field][0]===n.__fc__);let l;this.fc.targetFormDriver("loadRule",{rule:s,api:this.api},this.fc),this.ruleEffect(s,"init",{repeat:a()}),a()&&this.vm.emit("repeat-field",n,this.api);let c=!1,u=!!n.__fc__,d=s.value;if(u)if(l=n.__fc__,d=l.defaultValue,l.deleted){if(ze(l))return;l.update(this)}else if(!l.check(this)){if(ze(l))return;e[o]=n=n._clone?n._clone():he(n),l=null,c=!0}if(l)l.originType!==l.rule.type&&l.updateType(),this.bindParser(l),this.appendValue(l.rule),l.parent&&l.parent!==t&&this.rmSubRuleData(l);else{const e=this.parseRule(n);l=new He(this,e,d),this.bindParser(l)}this.parseEmit(l),this.syncProp(l),l.parent=t||null,l.root=e,this.setCtx(l),c||u||(this.effect(l,"load"),this.targetHook(l,"load")),this.effect(l,"created");const h=l.loadChildrenPending();if(!1===l.parser.loadChildren||r(h,l),!t){const e=i(o);e>-1||!o?this.sort.splice(e+1,0,l.id):this.sort.push(l.id)}const p=l.rule;return l.updated||(l.updated=!0,$.Function(p.update)&&this.bus.$once("load-end",(()=>{this.refreshUpdate(l,p.value,"init")})),this.effect(l,"loaded")),this.refreshControl(l)&&(this.cycleLoad=!0),l})).filter((e=>!!e));t&&(t.children=n)},refreshControl(e){return e.input&&e.rule.control&&this.useCtrl(e)},useCtrl(e){const i=function(e){const t=e.rule.control||[];return $.Object(t)?[t]:t}(e),r=[],n=this.api;if(!i.length)return!1;for(let t=0;t<i.length;t++){const o=i[t],s=o.handle||function(e){return(we[o.condition||"=="]||we["=="])(e,o.value)};if(!$.trueArray(o.rule))continue;const a={...o,valid:ye((()=>s(e.rule.value,n))),ctrl:Ue(e,o.rule),isHidden:$.String(o.rule[0])};a.valid&&a.ctrl||!a.valid&&!a.ctrl&&!a.isHidden||r.push(a)}if(!r.length)return!1;const o=[];let s=!1;return this.deferSyncValue((()=>{r.reverse().forEach((({isHidden:t,valid:i,rule:r,prepend:a,append:l,child:c,ctrl:u,method:d})=>{if(t)return i?e.ctrlRule.push({__ctrl:!0,children:r,valid:i}):u&&e.ctrlRule.splice(e.ctrlRule.indexOf(u)>>>0,1),void o[i?"push":"unshift"]((()=>{"disabled"===d||"enabled"===d?this.api.disabled(!i,r):"display"===d?this.api.display(i,r):"required"===d?(r.forEach((e=>{this.api.setEffect(e,"required",i)})),i||this.api.clearValidateState(r)):this.api.hidden(!i,r)}));if(i){s=!0;const t={type:"fragment",native:!0,__ctrl:!0,children:r};e.ctrlRule.push(t),this.bus.$once("load-start",(()=>{a?n.prepend(t,a,c):l||c?n.append(t,l||e.id,c):e.root.splice(e.root.indexOf(e.origin)+1,0,t)}))}else{e.ctrlRule.splice(e.ctrlRule.indexOf(u),1);const t=ve(u);t&&t.rm()}}))})),o.length&&(this.loading?o.length&&this.bus.$once("load-end",(()=>{o.forEach((e=>e()))})):o.length&&t.nextTick((()=>{o.forEach((e=>e()))}))),this.vm.emit("control",e.origin,this.api),this.effect(e,"control"),s},reloadRule(e){return this._reloadRule(e)},_reloadRule(e){e||(e=this.rules);const t={...this.ctxs};this.clearNextTick(),this.initData(e),this.fc.rules=e,this.deferSyncValue((()=>{this.bus.$once("load-end",(()=>{Object.keys(t).filter((e=>void 0===this.ctxs[e])).forEach((e=>this.rmCtx(t[e]))),this.$render.clearCacheAll()})),this.reloading=!0,this.loadRule(),this.reloading=!1,this.refresh(),this.bus.$emit("reloading",this.api)})),this.bus.$off("next-tick",this.nextReload),this.bus.$once("next-tick",this.nextReload),this.bus.$emit("update",this.api)},refresh(){this.vm.setupState.refresh()}})}(Ge),function(e){P(e.prototype,{setValue(e,t,i,r){e.deleted||(e.rule.value=t,this.changeStatus=!0,this.nextRefresh(),this.$render.clearCache(e),this.setFormData(e,i),this.syncValue(),this.valueChange(e,t),this.vm.emit("change",e.field,t,e.origin,this.api,r||!1),this.effect(e,"value"),this.targetHook(e,"value",{value:t}),this.emitEvent("change",e.field,t,{rule:e.origin,api:this.api,setFlag:r||!1}))},onInput(e,t){let i;e.input&&(this.isQuote(e,i=e.parser.toValue(t,e))||this.isChange(e,t))&&this.setValue(e,i,t)},onUpdateValue(e,t){this.deferSyncValue((()=>{const i=e.getParentGroup(),r=i?this.subRuleData[i.id]:null,n={};Object.keys(t||{}).forEach((e=>{r&&_(r,e)?n[e]=t[e]:_(this.api.form,e)?this.api.form[e]=t[e]:this.api.top!==this.api&&_(this.api.top.form,e)&&(this.api.top.form[e]=t[e])})),Object.keys(n).length&&this.api.setChildrenFormData(i.rule,n)}))},onBaseInput(e,t){this.setFormData(e,t),e.modelValue=t,this.nextRefresh(),this.$render.clearCache(e)},setFormData(e,t){e.modelValue=t;const i=e.getParentGroup();i&&(this.subRuleData[i.id]||(this.subRuleData[i.id]={}),this.subRuleData[i.id][e.field]=e.rule.value),R(this.formData,e.id,t)},rmSubRuleData(e){const t=e.getParentGroup();t&&this.subRuleData[t.id]&&delete this.subRuleData[t.id][e.field]},getFormData(e){return this.formData[e.id]},syncForm(){const e=t.reactive({}),i=this.fields(),r=[];!1!==this.options.appendValue&&Object.keys(this.appendData).reduce(((e,r)=>(-1===i.indexOf(r)&&(e[r]=t.toRef(this.appendData,r)),e)),e),i.reduce(((e,i)=>{const n=(this.fieldCtx[i]||[]).filter((e=>!this.isIgnore(e.rule)))[0]||this.fieldCtx[i][0];return this.isIgnore(n.rule)&&r.push(i),e[i]=t.toRef(n.rule,"value"),e}),e),this.form=e,this.ignoreFields=r,this.syncValue()},isIgnore(e){return!0===e.ignore||"hidden"===e.ignore&&e.hidden||this.options.ignoreHiddenFields&&e.hidden},appendValue(e){(e.field&&_(this.appendData,e.field)||this.options.forceCoverValue)&&(e.value=this.appendData[e.field],delete this.appendData[e.field])},addSubForm(e,t){this.subForm[e.id]=t},deferSyncValue(e,t){this.deferSyncFn||(this.deferSyncFn=e),this.deferSyncFn.sync||(this.deferSyncFn.sync=t),ye(e),this.deferSyncFn===e&&(this.deferSyncFn=null,e.sync&&this.syncForm())},syncValue(){if(this.deferSyncFn)return this.deferSyncFn.sync=!0;const e={};Object.keys(this.form).forEach((t=>{-1===this.ignoreFields.indexOf(t)&&(e[t]=this.form[t])})),this.vm.setupState.updateValue(e)},isChange(e,t){return JSON.stringify(this.getFormData(e),Ye)!==JSON.stringify(t,Ye)},isQuote:(e,t)=>($.Object(t)||Array.isArray(t))&&t===e.rule.value,refreshUpdate(e,t,i,r){if($.Function(e.rule.update)){const n=ye((()=>e.rule.update(t,e.origin,this.api,{origin:i||"change",linkField:r})));if(void 0===n)return;e.rule.hidden=!0===n}},valueChange(e,t){this.refreshRule(e,t),this.bus.$emit("change-"+e.field,t)},refreshRule(e,t,i,r){this.refreshControl(e)&&(this.$render.clearCacheAll(),this.loadRule(),this.bus.$emit("update",this.api),this.refresh()),this.refreshUpdate(e,t,i,r)},appendLink(e){const t=e.rule.link;$.trueArray(t)&&t.forEach((t=>{const i=()=>this.refreshRule(e,e.rule.value,"link",t);this.bus.$on("change-"+t,i),e.linkOn.push((()=>this.bus.$off("change-"+t,i)))}))},fields(){return Object.keys(this.fieldCtx)}})}(Ge),function(e){P(e.prototype,{getCtx(e){return this.getFieldCtx(e)||this.getNameCtx(e)[0]||this.ctxs[e]},getCtxs(e){return this.fieldCtx[e]||this.nameCtx[e]||(this.ctxs[e]?[this.ctxs[e]]:[])},setIdCtx(e,t,i){const r=`${i}Ctx`;this[r][t]?this[r][t].push(e):this[r][t]=[e]},rmIdCtx(e,t,i){const r=`${i}Ctx`,n=this[r][t];if(!n)return!1;const o=n.splice(n.indexOf(e)>>>0,1).length>0;return n.length||delete this[r][t],o},getFieldCtx(e){return(this.fieldCtx[e]||[])[0]},getNameCtx(e){return this.nameCtx[e]||[]},setCtx(e){let{id:t,field:i,name:r,rule:n}=e;this.ctxs[t]=e,r&&this.setIdCtx(e,r,"name"),e.input&&(this.setIdCtx(e,i,"field"),this.setFormData(e,e.parser.toFormValue(n.value,e)),this.isMounted&&!this.reloading&&this.vm.emit("change",e.field,n.value,e.origin,this.api))},getParser(e){const t=this.fc.parsers,i=this.fc.renderDriver;if(i){const t=i.parsers||{},r=t[e.originType]||t[re(e.type)]||t[e.trueType];if(r)return r}return t[e.originType]||t[re(e.type)]||t[e.trueType]||qe},bindParser(e){e.setParser(this.getParser(e))},getType(e){const t=this.fc.CreateNode.aliasMap,i=t[e]||t[re(e)]||e;return re(i)},noWatch(e){this.noWatchFn||(this.noWatchFn=e),ye(e),this.noWatchFn===e&&(this.noWatchFn=null)},watchCtx(e){if(ee().filter((e=>"_"!==e[0]&&"$"!==e[0]&&-1===Je.indexOf(e))).forEach((i=>{const r=t.toRef(e.rule,i),n="children"===i;e.refRule[i]=r,e.watch.push(t.watch(n?()=>$.Function(r.value)?r.value:[...r.value||[]]:()=>r.value,((o,s)=>{let a=r.value;if(!this.isBreakWatch()){if(n&&!1===e.parser.loadChildren)return this.$render.clearCache(e),void this.nextRefresh();if(this.watching=!0,t.nextTick((()=>{this.targetHook(e,"watch",{key:i,oldValue:s,newValue:a})})),"hidden"===i&&Boolean(a)!==Boolean(s)&&(this.$render.clearCacheAll(),t.nextTick((()=>{this.targetHook(e,"hidden",{value:a})}))),"ignore"===i&&e.input||"hidden"===i&&e.input&&("hidden"===e.rule.ignore||this.options.ignoreHiddenFields))this.syncForm();else{if("link"===i)return void e.link();["props","on","deep"].indexOf(i)>-1?(this.parseInjectEvent(e.rule,a||{}),"props"===i&&e.input&&this.setFormData(e,e.parser.toFormValue(e.rule.value,e))):"emit"===i?this.parseEmit(e):["prefix","suffix"].indexOf(i)>-1?a&&this.loadFn(a,e.rule):"type"===i?(e.updateType(),this.bindParser(e)):n&&($.Function(s)&&(s=e.getPending("children",[])),$.Function(a)&&(a=e.loadChildrenPending()),this.updateChildren(e,a,s))}this.$render.clearCache(e),this.refresh(),this.watching=!1}}),{deep:!n,sync:n}))})),e.refRule.__$title=t.computed((()=>{let t=("object"==typeof e.rule.title?e.rule.title.title:e.rule.title)||"";if(t){const e=t.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);e&&(t=this.api.t(e[1]))}return t})),e.refRule.__$info=t.computed((()=>{let t=("object"==typeof e.rule.info?e.rule.info.info:e.rule.info)||"";if(t){const e=t.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);e&&(t=this.api.t(e[1]))}return t})),e.refRule.__$validate=t.computed((()=>r(e.rule.validate).map((t=>{const i={...t};if(i.message){const t=i.message.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);t&&(i.message=this.api.t(t[1],{title:e.refRule.__$title.value}))}if($.Function(i.validator)){const r=e;return i.validator=function(...e){return t.validator.call({that:this,id:r.id,field:r.field,rule:r.rule,api:r.$handle.api},...e)},i}return i})))),e.input){const i=t.toRef(e.rule,"value");e.watch.push(t.watch((()=>i.value),(()=>{let t=e.parser.toFormValue(i.value,e);this.isChange(e,t)&&this.setValue(e,i.value,t,!0)})))}this.bus.$once("load-end",(()=>{let i=e.rule.computed;i&&("object"!=typeof i&&(i={value:i}),Object.keys(i).forEach((r=>{let n;const o=t.computed((()=>{const t=i[r];if(!t)return;const o=this.compute(e,t);return t.linkage&&void 0===o?n:o})),s=t=>{"value"===r?this.onInput(e,t):"$"===r[0]?this.api.setEffect(e.id,r,t):Be(e.rule,r,t)};("value"===r?[void 0,null,""].indexOf(e.rule.value)>-1:o.value!==ke(e.rule,r))&&s(o.value),e.watch.push(t.watch(o,(e=>{n=e,setTimeout((()=>{s(e)}))})))})))})),this.watchEffect(e)},compute(e,t){let i;if("object"==typeof t){const i=e.getParentGroup(),r=t=>{if(t=Array.isArray(t)?{mode:"AND",group:t}:t,!$.trueArray(t.group))return!0;const n="OR"===t.mode;let o=!0;for(let s=0;s<t.group.length;s++){const a=t.group[s];let l,c=a.field;if(a.variable&&(c=JSON.stringify(this.fc.getLoadData(a.variable)||"")),l=a.mode?r(a):!!we[a.condition]&&($.Function(a.handler)?ye((()=>a.handler(this.api,e.rule))):new Function("$condition","$val","$form","$group","$rule",`with($form){with(this){with($group){ return $condition['${a.condition}'](${c}, ${a.compare?a.compare:"$val"}); }}}`).call(this.api.form,we,a.value,this.api.top.form,i&&this.subRuleData[i.id]||{},e.rule)),n&&l)return!0;n||(o=o&&l)}return!n&&o};let n=r(t);return n=!0===t.invert?!n:n,t.linkage?n?ye((()=>this.computeValue(t.linkage,e,i)),void 0):void 0:n}if($.Function(t))i=()=>t(this.api.form,this.api);else{const r=e.getParentGroup();i=()=>this.computeValue(t,e,r)}return ye(i,void 0)},computeValue(e,t,i){const r=this,n=Object.keys(this.fc.formulas).reduce(((e,i)=>(e[i]=function(...e){return r.fc.formulas[i].call({that:this,rule:t.rule,api:r.api,fc:r.fc},...e)},e)),{});return new Function("$formulas","$form","$group","$rule","$api",`with($form){with(this){with($group){with($formulas){ return ${e} }}}}`).call(this.api.form,n,this.api.top.form,i&&this.subRuleData[i.id]||{},t.rule,this.api)},updateChildren(e,t,i){this.deferSyncValue((()=>{i&&i.forEach((i=>{-1===(t||[]).indexOf(i)&&i&&!$.String(i)&&i.__fc__&&i.__fc__.parent===e&&this.rmCtx(i.__fc__)})),$.trueArray(t)&&(this.loadChildren(t,e),this.bus.$emit("update",this.api))}))},rmSub(e){$.trueArray(e)&&e.forEach((e=>{e&&e.__fc__&&this.rmCtx(e.__fc__)}))},rmCtx(e){if(e.deleted)return;const{id:t,field:i,input:r,name:n}=e;F(this.ctxs,t),F(this.formData,t),F(this.subForm,t),F(this.vm.setupState.ctxInject,t);const o=e.getParentGroup();o&&this.subRuleData[o.id]&&F(this.subRuleData[o.id],i),e.group&&F(this.subRuleData,t),r&&this.rmIdCtx(e,i,"field"),n&&this.rmIdCtx(e,n,"name"),r&&!_(this.fieldCtx,i)&&F(this.form,i),this.deferSyncValue((()=>{if(!this.reloading){if(!1!==e.parser.loadChildren){const t=e.getPending("children",e.rule.children);$.trueArray(t)&&t.forEach((e=>e.__fc__&&this.rmCtx(e.__fc__)))}e.root===this.rules&&this.vm.setupState.renderRule()}}),r);const s=this.sort.indexOf(t);return s>-1&&this.sort.splice(s,1),this.$render.clearCache(e),e.delete(),this.effect(e,"deleted"),this.targetHook(e,"deleted"),r&&!this.fieldCtx[i]&&this.vm.emit("remove-field",i,e.rule,this.api),e.rule.__ctrl||this.vm.emit("remove-rule",e.rule,this.api),e}})}(Ge),function(e){P(e.prototype,{mounted(){const e=()=>{this.isMounted=!0,this.lifecycle("mounted")};this.pageEnd?e():this.bus.$once("page-end",e)},lifecycle(e){this.fc.targetFormDriver(e,this.api,this.fc),this.vm.emit(e,this.api),this.emitEvent(e,this.api)},emitEvent(e,...t){const i=this.options[e]||this.options[re("on-"+e)];if(i){const e=ce(i);$.Function(e)&&ye((()=>e(...t)))}this.bus.$emit(e,...t)},targetHook(e,t,i){var r;let n=null===(r=e.prop)||void 0===r||null===(r=r.hook)||void 0===r?void 0:r[t];n&&(n=Array.isArray(n)?n:[n],n.forEach((t=>{ye((()=>t({...i||{},rule:e.rule,api:this.api})))})))}})}(Ge),function(e){P(e.prototype,{useProvider(){const e=this.fc.providers;Object.keys(e).forEach((t=>{let i=e[t];$.Function(i)&&(i=i(this.fc)),i._c=function(e){const t=e.components;if(Array.isArray(t)){const e=function(e){return e.filter((function(e,t,i){return i.indexOf(e,0)===t}))}(t.filter((e=>"*"!==e)));return!!e.length&&e}return!!$.String(t)&&[t]}(i),this.onEffect(i),this.providers[t]=i}))},onEffect(e){const t=[];(e._c||["*"]).forEach((i=>{const r="*"===i?"*":this.getType(i);t.indexOf(r)>-1||(t.push(r),this.bus.$on(`p:${e.name}:${r}:${e.input?1:0}`,((t,i)=>{e[t]&&e[t](...i)})))})),e._used=t},watchEffect(e){let i={required:()=>{var t;return(_(e.rule,"$required")?e.rule.$required:null===(t=e.rule)||void 0===t||null===(t=t.effect)||void 0===t?void 0:t.required)||!1}};Object.keys(e.rule.effect||{}).forEach((t=>{i[t]=()=>e.rule.effect[t]})),Object.keys(e.rule).forEach((t=>{"$"===t[0]&&(i[t.substr(1)]=()=>e.rule[t])})),Object.keys(i).forEach((r=>{e.watch.push(t.watch(i[r],(t=>{this.effect(e,"watch",{[r]:t})}),{deep:!0}))}))},ruleEffect(e,t,i){this.emitEffect({rule:e,input:!!e.field,type:this.getType(e.type)},t,i)},effect(e,t,i){this.emitEffect({rule:e.rule,input:e.input,type:e.trueType,ctx:e,custom:i},t)},getEffect:(e,t)=>_(e,"$"+t)?e["$"+t]:_(e,"effect")&&_(e.effect,t)?e.effect[t]:void 0,emitEffect({ctx:e,rule:t,input:i,type:r,custom:n},o,s){if(!r||["fcFragment","fragment"].indexOf(r)>-1)return;const a=n||Object.keys(t).reduce(((e,i)=>("$"===i[0]&&(e[i.substr(1)]=t[i]),e)),{...t.effect||{}});Object.keys(a).forEach((n=>{const l=this.providers[n];if(!l||l.input&&!i)return;let c;if(l._c){if(!(l._used.indexOf(r)>-1))return;c=r}else c="*";const u={value:a[n],getValue:()=>this.getEffect(t,n),...s||{}};e&&(u.getProp=()=>e.effectData(n),u.clearProp=()=>e.clearEffectData(n),u.mergeProp=e=>fe(u.getProp(),[e]),u.id=e.id),this.bus.$emit(`p:${n}:${c}:${l.input?1:0}`,o,[u,t,this.api])}))}})}(Ge);var We=t.defineComponent({name:"fcFragment",inheritAttrs:!1,props:["vnode"],render(){return this.vnode}});function Ke(e,i){let r=e.directives;return r?(Array.isArray(r)||(r=[r]),t.withDirectives(i,r.reduce(((e,i)=>e.concat(function(e){return Object.keys(e).map((i=>{const r=e[i],n=t.resolveDirective(i);if(n)return[n,r.value,r.arg,r.modifiers]})).filter((e=>!!e))}(i))),[]))):i}function Xe(e){class t extends Qe{}return Object.assign(t.prototype,e),t}function Qe(e){P(this,{$handle:e,vm:e.vm,options:{},ref:"fcForm",mergeOptionsRule:{normal:["form","row","info","submitBtn","resetBtn"]}}),this.updateKey(),this.init()}P(Qe.prototype,{__init(){this.$render=this.$handle.$render,this.$r=(...e)=>this.$render.renderRule(...e)},updateKey(){this.key=Ie()},init(){},update(){},beforeRender(){},form(){return this.vm.refs[this.ref]},getSlot(e){const t=i=>{if(i){let r=i.slots[e];return r||t(i.setupState.parent)}};return t(this.vm)},mergeOptions(e,t){return W(e.map((e=>this.tidyOptions(e))),t,this.mergeOptionsRule)},updateOptions(e){this.$handle.fc.targetFormDriver("updateOptions",e,{handle:this.$handle,api:this.$handle.api}),this.options=this.mergeOptions([e],this.getDefaultOptions()),this.update()},tidyOptions:e=>e,tidyRule(e){},mergeProp(e){},getDefaultOptions:()=>({}),render(e){}});const Ze={name:"componentValidate",load(e,t,i){let r=e.getValue();if(r&&!1!==r.method){$.Object(r)||(r={method:r});const n=r.method;delete r.method,e.getProp().validate=[{...r,validator(...r){const o=ve(t);if(o)return i.exec(o.id,$.String(n)?n:"formCreateValidate",...r,{attr:e,rule:t,api:i})}}]}else e.clearProp(),i.clearValidateState([t.field])},watch(...e){Ze.load(...e)}};var et={fetch:function(e){function t(t,r,n){let o=t.value;i.deleted(t),$.Function(o)&&(o=o(r,n)),o=function(e){return $.String(e)&&(e={action:e,to:"options"}),e}(o);const s=i=>{void 0===i?t.clearProp():Be(t.getProp(),o.to||"options",i),null!=i&&o&&o.key&&e.$handle.options.globalData[o.key]&&e.fetchCache.set(e.$handle.options.globalData[o.key],{status:!0,data:i}),n.sync(r)};if(!o||!o.action&&!o.key)return void s(void 0);if(o=D(o),o.to||(o.to="options"),o.key){const t=e.$handle.options.globalData[o.key];if(!t)return void s(void 0);if("static"===t.type)return void s(t.data);o={...o,...t}}const a=o.onError,l=()=>{if(!t.getValue())return t.clearProp(),n.sync(r),!0};i._fn[t.id]=e.watchLoadData(H(((c,u)=>{if(u&&!1===o.watch)return i._fn[t.id]();const d=e.$handle.loadFetchVar(D(o),c),h={headers:{},...d,onSuccess(e,t){if(l())return;let i=e=>t?e:_(e,"data")?e.data:e;const o=ce(d.parse);$.Function(o)?i=o:o&&$.String(o)&&(i=e=>ke(e,o)),s(i(e,r,n)),n.sync(r)},onError(e){s(void 0),l()||(a||(e=>ie(e.message||"fetch fail "+d.action)))(e,r,n)}};e.$handle.beforeFetch(h,{rule:r,api:n}).then((()=>{$.Function(d.action)?d.action(r,n).then((e=>{h.onSuccess(e,!0)})).catch((e=>{h.onError(e)})):ye((()=>e.create.fetch(h,{inject:t,rule:r,api:n})))}))}),o.wait||600))}const i={name:"fetch",_fn:[],mounted(...e){t(...e)},watch(...e){t(...e)},deleted(e){this._fn[e.id]&&(this._fn[e.id](),delete this._fn[e.id]),e.clearProp()}};return i},loadData:function(e){const t={name:"loadData",_fn:[],mounted(t,i,n){this.deleted(t);let o=r(t.getValue());const s=[];o.forEach((r=>{if(r&&(r.attr||r.template)){let o=o=>{let s;s=r.template?e.$handle.loadStrVar(r.template,o):o(r.attr,r.default),!1!==r.copy&&(s=D(s));const a=r.modify?i:t.getProp();"child"===r.to?a.children?a.children[0]=s:a.children=[s]:Be(a,r.to||"options",s),n.sync(i)},a=e=>o(e);const l=e.watchLoadData(a);o=H(o,r.wait||300),!1!==r.watch?s.push(l):l()}})),this._fn[t.id]=s},deleted(e){this._fn[e.id]&&(this._fn[e.id].forEach((e=>{e()})),delete this._fn[e.id]),e.clearProp()}};return t.watch=t.mounted,t},t:function(e){const t={name:"t",_fn:[],loaded(t,i,r){this.deleted(t);let n=t.getValue()||{};const o=[];Object.keys(n).forEach((s=>{const a=n[s];if(a){const n="object"==typeof a;let l=o=>{let l=e.t(n?a.attr:a,n?a.params:null,o);const c=n&&a.modify?i:t.getProp();"child"===s?c.children?c.children[0]=l:c.children=[l]:Be(c,s,l),r.sync(i)},c=e=>l(e);const u=e.watchLoadData(c);l=H(l,a.wait||300),!1!==a.watch?o.push(u):u()}})),this._fn[t.id]=o},deleted(e){this._fn[e.id]&&(this._fn[e.id].forEach((e=>{e()})),delete this._fn[e.id]),e.clearProp()}};return t.watch=t.loaded,t},componentValidate:Ze};var tt={name:"html",loadChildren:!1,render:(e,t)=>(t.prop.props.innerHTML=e.default(),t.vNode.make(t.prop.props.tag||"div",t.prop)),renderChildren:e=>({default:()=>e.filter((e=>$.String(e))).join("")})};function it(e){e+="=";const t=decodeURIComponent(document.cookie).split(";");for(let i=0;i<t.length;i++){let r=t[i];for(;" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(e)){r=r.substring(e.length,r.length);try{return JSON.parse(r)}catch(e){return r}}}return null}function rt(e){const t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return t}return null}function nt(e,t){if(!t)return null;const i=t.split(".");let r=e(i.shift());return i.length?null==r?null:ke(r,i):r}function ot(e){return nt(it,e)}function st(e){return nt(rt,e)}function at(){return function(e,t){let i;return 2===arguments.length?(i=arguments[1],t=i[e]):i=arguments[2],{id:t,prop:i}}("name",...arguments)}let lt=1;const ct={};function ut(e){const i={[We.name]:We},r={},n={},s={},a={},l=[],c=[],u=[e.extendApi],d={...et},h=Re();let p={global:{}};const f=t.reactive({}),m=function(){const e={};function i(){}return P(i.prototype,{make(e,t,i){return Ke(t,this.h(e,$e(t),i))},makeComponent(e,i,r){try{return Ke(i,t.createVNode(e,$e(i),r))}catch(e){return console.error(e),t.createVNode("")}},h(e,i,r){const n=t.getCurrentInstance().appContext.config.isNativeTag(e);n&&delete i.formCreateInject;try{return t.createVNode(n?e:t.resolveComponent(e),i,r)}catch(e){return console.error(e),t.createVNode("")}},aliasMap:e}),P(i,{aliasMap:e,alias(t,i){e[t]=i},use(e){Object.keys(e).forEach((t=>{const r=U(t),n=Pe(t).toLocaleLowerCase(),o=e[t];[t,r,n].forEach((e=>{i.alias(t,o),i.prototype[e]=function(e,t){return this.make(o,e,t)}}))}))}}),i}(),g={},v=!0===e.isMobile,y={};function b(e){const t=ct[e];return Array.isArray(t)?t.map((e=>e.api())):t?t.api():void 0}function x(e){l.push(e)}function w(){const e=at(...arguments);e.id&&e.prop&&(n[e.id]=e.prop)}function k(){const e=at(...arguments);e.id&&e.prop&&(d[e.id]=$.Function(e.prop)?e.prop:{...e.prop,name:e.id})}function C(e){m.use(e)}function V(){const e=at(...arguments);if(!e.id||!e.prop)return qe;const t=re(e.id),i=e.prop,n=!0===i.merge?r[t]:void 0;r[t]=_e(i,n||qe),h[t]=Ce(t),i.maker&&P(h,i.maker)}function O(e,t){let n;if($.String(e)){if(n=e,void 0===t)return i[n]}else n=e.displayName||e.name,t=e;if(!n||!t)return;const o=re(n);i[n]=t,i[o]=t,delete m.aliasMap[n],delete m.aliasMap[o],delete r[n],delete r[o],t.formCreateParser&&V(n,t.formCreateParser)}function S(){return Y(W,i,n)}function E(){return We}function R(e,t){return $.Function(e.install)?e.install(F,t):$.Function(e)&&e(F,t),this}function F(e,i){let r=function(e,i){const r=S();return t.createApp({data:()=>t.reactive({rule:e,option:i}),render(){return t.h(r,{ref:"fc",...this.$data})}})}(e,i||{});l.forEach((e=>{ye((()=>e(F,r)))}));const n=document.createElement("div");((null==i?void 0:i.el)||document.body).appendChild(n);return r.mount(n).$refs.fc.fapi}function j(t){let o={...e};return t?o.inherit={components:i,parsers:r,directives:n,modelFields:s,providers:d,useApps:l,maker:h,formulas:g,loadData:f}:delete o.inherit,ut(o)}function A(e,t){s[e]=t}function I(e,t){g[e]=t}function B(e,t){const i=a[e]||{},r=i.parsers||{};t.parsers&&Object.keys(t.parsers).forEach((e=>{r[e]=_e(t.parsers[e],qe)})),t.name=e,a[e]={...i,...t,parsers:r}}function T(e){e&&Object.keys(ct).forEach((t=>{(Array.isArray(ct[t])?ct[t]:[ct[t]]).forEach((t=>{t.bus.$emit("$loadData."+e)}))}))}function L(e,t){Be(f,e,t),T(e)}function M(e,t){const i=(...e)=>ye((()=>t(...e)));i._driver=!0,L(e,i)}function z(e,t){const i=(e||"").split(".");e=i.shift();const r=i.join(".");if(_(f,e)){let n=f[e];return n&&n._driver?n=n(r):i.length&&(n=ke(n,i)),null==n||""===n?t:n}return t}function q(e){u.push(e)}function J(e){delete f[e],T(e)}function G(e,t){c.push({name:e,callback:t})}function W(l){P(this,{id:lt++,create:F,vm:l,manager:Xe(e.manager),parsers:r,providers:d,modelFields:s,formulas:g,isMobile:v,rules:l.props.rule,name:l.props.name||Ie(),inFor:l.props.inFor,prop:{components:i,directives:n},drivers:a,renderDriver:null,refreshData:T,loadData:f,CreateNode:m,bus:new o,unwatch:[],options:t.ref({}),extendApiFn:u,fetchCache:new WeakMap,tmpData:t.reactive({})}),c.forEach((e=>{this.bus.$on(e.name,e.callback)})),t.nextTick((()=>{t.watch(this.options,(()=>{this.$handle.$manager.updateOptions(this.options.value),this.api().refresh()}),{deep:!0})})),P(l.appContext.components,i),P(l.appContext.directives,n),this.$handle=new Ge(this),this.name&&(this.inFor?(ct[this.name]||(ct[this.name]=[]),ct[this.name].push(this)):ct[this.name]=this)}function K(t){P(t,{version:e.version,ui:e.ui,isMobile:v,extendApi:q,getData:z,setDataDriver:M,setData:L,removeData:J,refreshData:T,maker:h,component:O,directive:w,setModelField:A,setFormula:I,setDriver:B,register:k,$vnode:E,parser:V,use:R,factory:j,componentAlias:C,copyRule:he,copyRules:pe,mergeRule:fe,fetch:je,$form:S,parseFn:ce,parseJson:ue,toJson:ae,useApp:x,getApi:b,on:G})}var ee;if(function(e){const t=e.key||[],i=e.array||[],r=e.normal||[];X.push(...t),Q.push(...i),Z.push(...r),Oe([...t,...i,...r])}(e.attrs||{}),_e(F,y),W.isMobile=v,P(W.prototype,{init(){this.isSub()&&this.unwatch.push(t.watch((()=>this.vm.setupState.parent.setupState.fc.options.value),(()=>{this.initOptions(),this.$handle.api.refresh()}),{deep:!0})),this.vm.props.driver&&(this.renderDriver="object"==typeof this.vm.props.driver?this.vm.props.driver:this.drivers[this.vm.props.driver]),!this.renderDriver&&this.vm.setupState.parent&&(this.renderDriver=this.vm.setupState.parent.setupState.fc.renderDriver),this.renderDriver||(this.renderDriver=this.drivers.default),this.initOptions(),this.$handle.init()},targetFormDriver(e,...t){if(this.renderDriver&&this.renderDriver[e])return ye((()=>this.renderDriver[e](...t)))},t(e,t,i){let r=i?i("$t."+e):this.globalLanguageDriver(e);return null==r&&this.vm.appContext.config.globalProperties.$i18n?this.vm.appContext.config.globalProperties.$i18n.t(e,t):(null==r&&(r=""),r&&t&&Object.keys(t).forEach((e=>{const i=new RegExp(`{${e}}`,"g");r=r.replace(i,t[e])})),r)},globalDataDriver(e){let t=e.split(".");const i=t.shift(),r=this.options.value.globalData&&this.options.value.globalData[i];if(r){if("static"===r.type)return ke(r.data,t);{let e;const n=this.fetchCache.get(r);if(n){if(n.status&&(e=ke(n.data,t)),!n.loading)return e;n.loading=!1,this.fetchCache.set(r,n)}else this.fetchCache.set(r,{status:!1});const o=H((()=>{l();const e=this.fetchCache.get(r);this.options.value.globalData&&-1!==Object.values(this.options.value.globalData).indexOf(r)?(e&&(e.loading=!0,this.fetchCache.set(r,e)),this.bus.$emit("$loadData.$globalData."+i)):this.fetchCache.delete(r)}),r.wait||600),s=e=>{this.fetchCache.set(r,{status:!0,data:e}),this.bus.$emit("$loadData.$globalData."+i)},a=(e,t)=>{if(t&&!1===r.watch)return l();if(t)return void o();const i=this.$handle.loadFetchVar(N(r),e);this.$handle.api.fetch(i).then((e=>{s(e)})).catch((e=>{s(null)}))},l=this.watchLoadData(a);return this.unwatch.push(l),e}}},getLocale(){let e=this.vm.setupState.top.props.locale;return e&&"object"==typeof e?e.name:"string"==typeof e?e:this.vm.appContext.config.globalProperties.$i18n&&this.vm.appContext.config.globalProperties.$i18n.locale?this.vm.appContext.config.globalProperties.$i18n.locale:"zh-cn"},globalLanguageDriver(e){let t,i=this.vm.setupState.top.props.locale;if(i&&"object"==typeof i&&(t=ke(i,e)),null==t){t=ke((this.options.value.language||{})[this.getLocale()],e)}return t},globalVarDriver(e){const t=e.split(".").shift(),i=this.options.value.globalVariable&&this.options.value.globalVariable[t];if(i){const e=$.Function(i)?i:i.handle;if(e){let i;const r=this.watchLoadData(((n,o)=>{if(o)return r(),this.bus.$emit("$loadData.$var."+t),i;i=ye((()=>e(n,this.$handle.api)))}));return this.unwatch.push(r),i}}},setData(e,t,i){i?L(e,t):(Be(this.vm.setupState.top.setupState.fc.tmpData,e,t),this.bus.$emit("$loadData."+e))},getLoadData(e,t){let i=null;if(null!=e){let t=e.split(".");const r=t.shift();if("$topForm"===r)i=this.$handle.api.top.formData();else if("$form"===r)i=this.$handle.api.formData();else if("$options"===r)i=this.options.value;else if("$globalData"===r)i=this.globalDataDriver(t.join(".")),t=[];else if("$var"===r)i=this.globalVarDriver(t.join(".")),t=[];else if("$locale"===r)i=this.getLocale(),t=[];else if("$t"===r)i=this.globalLanguageDriver(t.join(".")),t=[];else{const n=this.vm.setupState.top.setupState.fc.tmpData;i=_(n,r)?ke(n,e):z(e),t=[]}i&&t.length&&(i=ke(i,t))}return null==i||""===i?t:i},watchLoadData(e){let i={};const r=t=>{ye((()=>{e(n,t)}))},n=(e,n)=>{if(i[e])return i[e].val;const o=t.computed((()=>this.getLoadData(e,n))),s=e.split("."),a=s.shift(),l=s.shift()||"",c=H((()=>{const t=this.getLoadData(e,n);i[e]&&JSON.stringify(t)!==JSON.stringify(i[e].val)&&(i[e].val=t,r(!0))}),0),u=t.watch(o,(e=>{c()}));return this.bus.$on("$loadData."+a,c),l&&this.bus.$on("$loadData."+a+"."+l,c),i[e]={fn:()=>{this.bus.$off("$loadData."+a,c),l&&this.bus.$off("$loadData."+a+"."+l,c),u()},val:o.value},o.value};r(!1);const o=()=>{Object.keys(i).forEach((e=>i[e].fn())),i={}};return this.unwatch.push(o),o},isSub(){return this.vm.setupState.parent&&this.vm.props.extendOption},initOptions(){this.options.value={};let e={formData:{},submitBtn:{},resetBtn:{},globalEvent:{},globalData:{},...D(p)};this.isSub()&&(e=this.mergeOptions(e,this.vm.setupState.parent.setupState.fc.options.value||{},!0)),e=this.mergeOptions(e,this.vm.props.option),this.updateOptions(e)},mergeOptions(e,t,i){return t=D(t),i&&["page","onSubmit","onReset","onCreated","onChange","onMounted","mounted","onReload","reload","formData","el","globalClass","style"].forEach((e=>{delete t[e]})),t.global&&(e.global=function(e,t){return e?(Object.keys(t||{}).forEach((i=>{t[i]&&(e[i]=fe(e[i]||{},t[i]))})),e):t}(e.global,t.global),delete t.global),this.$handle.$manager.mergeOptions([t],e),e},updateOptions(e){this.options.value=this.mergeOptions(this.options.value,e),this.$handle.$manager.updateOptions(this.options.value),this.bus.$emit("$loadData.$options")},api(){return this.$handle.api},render(){return this.$handle.render()},mounted(){this.$handle.mounted()},unmount(){if(this.name)if(this.inFor){const e=ct[this.name].indexOf(this);ct[this.name].splice(e,1)}else delete ct[this.name];c.forEach((e=>{this.bus.$off(e.name,e.callback)})),this.tmpData={},this.unwatch.forEach((e=>e())),this.unwatch=[],this.$handle.reloadRule([])},updated(){this.$handle.bindNextTick((()=>this.bus.$emit("next-tick",this.$handle.api)))}}),K(y),P(ee=y,{create:F,install(t,i){p={...p,...i||{}};const r="_installedFormCreate_"+e.ui;if(!0===t[r])return;t[r]=!0;const n=function(e,t={}){return F(e,t)};K(n),t.config.globalProperties.$formCreate=n;const o=S();t.component(o.name,o),l.forEach((e=>{ye((()=>e(ee,t)))}))}}),M("$cookie",ot),M("$localStorage",st),m.use({fragment:"fcFragment"}),e.install&&F.use(e),x(((e,t)=>{t.mixin({props:["formCreateInject"]})})),V(tt),e.inherit){const t=e.inherit;t.components&&P(i,t.components),t.parsers&&P(r,t.parsers),t.directives&&P(n,t.directives),t.modelFields&&P(s,t.modelFields),t.providers&&P(d,t.providers),t.useApps&&P(l,t.useApps),t.maker&&P(h,t.maker),t.loadData&&P(f,t.loadData),t.formulas&&P(g,t.formulas)}const te=S();return _e(te,y),Object.defineProperties(te,{fetch:{get:()=>y.fetch,set(e){y.fetch=e}}}),te.util=y,te}const dt={date:"YYYY-MM-DD",month:"YYYY-MM",week:"YYYY-wo",datetime:"YYYY-MM-DD HH:mm:ss",timerange:"HH:mm:ss",daterange:"YYYY-MM-DD",monthrange:"YYYY-MM",datetimerange:"YYYY-MM-DD HH:mm:ss",year:"YYYY"},ht="datePicker";var pt={name:ht,maker:["year","month","date","dates","week","datetime","datetimeRange","dateRange","monthRange"].reduce(((e,t)=>(e[t]=Ce(ht,{type:t.toLowerCase()}),e)),{}),mergeProp(e){const t=e.prop.props;t.valueFormat||(t.valueFormat=dt[t.type]||dt.date)}};const ft="hidden";var mt={name:ft,maker:{[ft]:(e,t)=>Ce(ft)("",e,t)},render:()=>[]};const gt="input";var vt={name:gt,maker:function(){const e=["password","url","email","text","textarea"].reduce(((e,t)=>(e[t]=Ce(gt,{type:t}),e)),{});return e.idate=Ce(gt,{type:"date"}),e}(),mergeProp(e){let{props:t}=e.prop;t&&t.autosize&&t.autosize.minRows&&(t.rows=t.autosize.minRows||2)}};const yt="slider";const bt="timePicker";var $t=[pt,mt,vt,{name:yt,maker:{sliderRange:Ce(yt,{range:!0})},toFormValue(e,t){let i,r=Array.isArray(e),n=t.prop.props,o=n.min||0;return i=!0===n.range?r?e:[o,parseFloat(e)||o]:r?parseFloat(e[0])||o:parseFloat(e),i}},{name:bt,maker:{time:Ce(bt,(e=>e.props.isRange=!1)),timeRange:Ce(bt,(e=>e.props.isRange=!0))},mergeProp(e){const t=e.prop.props;t.valueFormat||(t.valueFormat="HH:mm:ss")}},{name:"FcRow",render:(e,t)=>t.vNode.col({props:{span:24}},{default:()=>[t.vNode.row(t.prop,e)]})},{name:"select",toFormValue:(e,t)=>t.prop.props.multiple&&!Array.isArray(e)?r(e):e}];var _t={button:"el-button",icon:"el-icon",slider:"el-slider",rate:"el-rate",upload:"fc-upload",cascader:"el-cascader",popover:"el-popover",tooltip:"el-tooltip",colorPicker:"el-colorPicker",timePicker:"el-time-picker",timeSelect:"el-time-select",datePicker:"el-date-picker",switch:"el-switch",select:"fc-select",checkbox:"fc-checkbox",radio:"fc-radio",inputNumber:"el-input-number",number:"el-input-number",input:"el-input",formItem:"el-form-item",form:"el-form",frame:"fc-frame",col:"el-col",row:"el-row",tree:"fc-tree",autoComplete:"el-autocomplete",auto:"el-autocomplete",group:"fc-group",array:"fc-group",object:"fc-sub-form",subForm:"fc-sub-form"};function xt(e,t){_(e,t)&&$.String(e[t])&&(e[t]={[t]:e[t],show:!0})}function wt(e){return!1===e}function kt(e){const t={...e};return delete t.children,t}var Ct={validate(){const e=this.form();return e?e.validate():new Promise((e=>e()))},validateField(e){return new Promise(((t,i)=>{const r=this.form();r?r.validateField(e,((e,r)=>{r?i(r):t(e)})):t()}))},clearValidateState(e){const t=this.vm.refs[e.wrapRef];t&&t.clearValidate()},tidyOptions:e=>(["submitBtn","resetBtn","row","info","wrap","col","title"].forEach((t=>{!function(e,t){_(e,t)&&!$.Object(e[t])&&(e[t]={show:!!e[t]})}(e,t)})),e),tidyRule:({prop:e})=>(xt(e,"title"),xt(e,"info"),e),mergeProp(e){const t={info:{trigger:"hover",placement:"top-start",icon:!0},title:{},col:{span:24},wrap:{}};["info","wrap","col","title"].forEach((i=>{e.prop[i]=W([this.options[i]||{},e.prop[i]||{}],t[i])}))},getDefaultOptions:()=>({form:{inline:!1,labelPosition:"right",labelWidth:"125px",disabled:!1,size:void 0},row:{show:!0,gutter:0},submitBtn:{type:"primary",loading:!1,disabled:!1,innerText:"提交",show:!0,col:void 0,click:void 0},resetBtn:{type:"default",loading:!1,disabled:!1,innerText:"重置",show:!1,col:void 0,click:void 0}}),update(){const e=this.options.form;this.rule={props:{...e},on:{submit:e=>{e.preventDefault()}},class:[e.className,e.class,"form-create",this.$handle.preview?"is-preview":""],style:e.style,type:"form"}},beforeRender(){const{key:e,ref:t,$handle:i}=this;P(this.rule,{key:e,ref:t}),P(this.rule.props,{model:i.formData})},render(e){return e.slotLen()&&!this.$handle.preview&&e.setSlot(void 0,(()=>this.makeFormBtn())),this.$r(this.rule,wt(this.options.row.show)?e.getSlots():[this.makeRow(e)])},makeWrap(e,t){const i=e.prop,r=`${this.key}${e.key}`,n=i.col,o=this.isTitle(i)&&!1!==i.wrap.title,s=n.labelWidth||o?n.labelWidth:0,{inline:a,col:l}=this.rule.props;delete i.wrap.title;const c=wt(i.wrap.show)?t:this.$r(W([i.wrap,{props:{labelWidth:void 0===s?s:Pe(s),label:o?i.title.title:void 0,...kt(i.wrap||{}),prop:e.id,rules:e.injectValidate()},class:this.$render.mergeClass(i.className,"fc-form-item"),key:`${r}fi`,ref:e.wrapRef,type:"formItem"}]),{default:()=>t,...o?{label:()=>this.makeInfo(i,r,e)}:{}});return!0===a||wt(l)||wt(n.show)?c:this.makeCol(i,r,[c])},isTitle(e){if(!1===this.options.form.title)return!1;const t=e.title;return!(!t.title&&!t.native||wt(t.show))},makeInfo(e,t,i){const r={...e.title},n={...e.info},o="tooltip"===n.type;const s=this.options.form,a=this.getSlot("title"),l=[a?a({title:i.refRule.__$title.value,rule:i.rule,options:this.options}):i.refRule.__$title.value+(s.labelSuffix||s["label-suffix"]||"")];if(!wt(n.show)&&(n.info||n.native)&&!wt(n.icon)){const e={type:n.type||"popover",props:kt(n),key:`${t}pop`};delete e.props.icon,delete e.props.show,delete e.props.info,delete e.props.align,delete e.props.native;const s="content";n.info&&!_(e.props,s)&&(e.props[s]=i.refRule.__$info.value),l["left"!==n.align?"unshift":"push"](this.$r(W([n,e]),{[r.slot||(o?"default":"reference")]:()=>this.$r({type:"ElIcon",style:"top:2px",key:`${t}i`},{default:()=>this.$r({type:!0===n.icon?"icon-warning":n.icon})},!0)}))}const c=W([r,{props:kt(r),key:`${t}tit`,class:"fc-form-title",type:r.type||"span"}]);return delete c.props.show,delete c.props.title,delete c.props.native,this.$r(c,l)},makeCol(e,t,i){const r=e.col;return this.$r({class:this.$render.mergeClass(r.class,"fc-form-col"),type:"col",props:r||{span:24},key:`${t}col`},i)},makeRow(e){const t=this.options.row||{};return this.$r({type:"row",props:t,class:this.$render.mergeClass(t.class,"fc-form-row"),key:`${this.key}row`},e)},makeFormBtn(){let e=[];if(wt(this.options.submitBtn.show)||e.push(this.makeSubmitBtn()),wt(this.options.resetBtn.show)||e.push(this.makeResetBtn()),!e.length)return;const t=this.$r({type:"formItem",class:"fc-form-item",key:`${this.key}fb`},e);return!0===this.rule.props.inline?t:this.$r({type:"col",class:"fc-form-col fc-form-footer",props:{span:24},key:`${this.key}fc`},[t])},makeResetBtn(){const e={...this.options.resetBtn},t=e.innerText;return delete e.innerText,delete e.click,delete e.col,delete e.show,this.$r({type:"button",props:e,class:"fc-reset-btn",style:{width:e.width},on:{click:()=>{const e=this.$handle.api;this.options.resetBtn.click?this.options.resetBtn.click(e):e.resetFields()}},key:`${this.key}b2`},[t])},makeSubmitBtn(){const e={...this.options.submitBtn},t=e.innerText;return delete e.innerText,delete e.click,delete e.col,delete e.show,this.$r({type:"button",props:e,class:"fc-submit-btn",style:{width:e.width},on:{click:()=>{const e=this.$handle.api;this.options.submitBtn.click?this.options.submitBtn.click(e):e.submit().catch((()=>{}))}},key:`${this.key}b1`},[t])}};const Vt={};!function(e){["group","tree","switch","upload","autoComplete","checkbox","cascader","colorPicker","datePicker","frame","inputNumber","radio","rate"].forEach((t=>{e[t]=Ce(t)})),e.auto=e.autoComplete,e.number=e.inputNumber,e.color=e.colorPicker}(Vt),function(e){const t="select",i="multiple";e.selectMultiple=Ce(t,{[i]:!0}),e.selectOne=Ce(t,{[i]:!1})}(Vt),function(e){const t={treeSelected:"selected",treeChecked:"checked"};Object.keys(t).reduce(((e,i)=>(e[i]=Ce("tree",{type:t[i]}),e)),e)}(Vt),function(e){const t={image:["image",0],file:["file",0],uploadFileOne:["file",1],uploadImageOne:["image",1]};Object.keys(t).reduce(((e,i)=>(e[i]=Ce("upload",(e=>e.props({uploadType:t[i][0],maxLength:t[i][1]}))),e)),e),e.uploadImage=e.image,e.uploadFile=e.file}(Vt),function(e){const t={frameInputs:["input",0],frameFiles:["file",0],frameImages:["image",0],frameInputOne:["input",1],frameFileOne:["file",1],frameImageOne:["image",1]};Object.keys(t).reduce(((e,i)=>(e[i]=Ce("frame",(e=>e.props({type:t[i][0],maxLength:t[i][1]}))),e)),e),e.frameInput=e.frameInputs,e.frameFile=e.frameFiles,e.frameImage=e.frameImages}(Vt);function Ot(e,t){return $.Boolean(e)?e={show:e}:$.Undef(e)||$.Object(e)||(e={show:t}),e}function St(e,t){return{formEl:()=>t.$manager.form(),wrapEl(e){const i=t.getFieldCtx(e);if(i)return t.vm.refs[i.wrapRef]},validate:i=>new Promise(((r,n)=>{const o=e.children,s=[t.$manager.validate()];o.forEach((e=>{s.push(e.validate())})),Promise.all(s).then((()=>{r(!0),i&&i(!0)})).catch((r=>{n(r),i&&i(r),t.vm.emit("validate-fail",r,{api:e})}))})),validateField:(i,n)=>new Promise(((o,s)=>{const a=t.getFieldCtx(i);if(!a)return;const l=t.subForm[a.id],c=[t.$manager.validateField(a.id)];r(l).forEach((e=>{c.push(e.validate())})),Promise.all(c).then((()=>{o(null),n&&n(null)})).catch((r=>{s(r),n&&n(r),t.vm.emit("validate-field-fail",r,{field:i,api:e})}))})),clearValidateState(i,r=!0){e.helper.tidyFields(i).forEach((e=>{r&&this.clearSubValidateState(e),t.getCtxs(e).forEach((e=>{t.$manager.clearValidateState(e)}))}))},clearSubValidateState(i){e.helper.tidyFields(i).forEach((e=>{t.getCtxs(e).forEach((e=>{const i=t.subForm[e.id];i&&(Array.isArray(i)?i.forEach((e=>{e.clearValidateState()})):i&&i.clearValidateState())}))}))},btn:{loading:(t=!0)=>{e.submitBtnProps({loading:!!t})},disabled:(t=!0)=>{e.submitBtnProps({disabled:!!t})},show:(t=!0)=>{e.submitBtnProps({show:!!t})}},resetBtn:{loading:(t=!0)=>{e.resetBtnProps({loading:!!t})},disabled:(t=!0)=>{e.resetBtnProps({disabled:!!t})},show:(t=!0)=>{e.resetBtnProps({show:!!t})}},submitBtnProps:(i={})=>{let r=Ot(t.options.submitBtn,!0);P(r,i),t.options.submitBtn=r,e.refreshOptions()},resetBtnProps:(i={})=>{let r=Ot(t.options.resetBtn,!1);P(r,i),t.options.resetBtn=r,e.refreshOptions()},submit:(i,r)=>new Promise(((n,o)=>{e.validate().then((()=>{let r=e.formData();$.Function(i)&&ye((()=>i(r,e))),$.Function(t.options.onSubmit)&&ye((()=>t.options.onSubmit(r,e))),t.vm.emit("submit",r,e),n(r)})).catch(((...t)=>{$.Function(r)&&ye((()=>r(e,...t))),o(...t)}))}))}}s(".form-create .form-create .el-form-item{margin-bottom:22px}.form-create{width:100%}.form-create .fc-none,.form-create.is-preview .el-form-item.is-required>.el-form-item__label-wrap>.el-form-item__label:before,.form-create.is-preview .el-form-item.is-required>.el-form-item__label:before,.form-create.is-preview .fc-clock{display:none!important}.fc-wrap-right>.el-form-item__label{display:flex;justify-content:flex-end}.fc-wrap-left>.el-form-item__label{display:flex;justify-content:flex-start}.fc-wrap-top.el-form-item{display:block}.fc-wrap-top.el-form-item>.el-form-item__label{display:block;height:auto;line-height:22px;margin-bottom:8px;text-align:left}.el-form--large .fc-wrap-top.el-form-item>.el-form-item__label{line-height:22px;margin-bottom:12px}.el-form--default .fc-wrap-top.el-form-item>.el-form-item__label{line-height:22px;margin-bottom:8px}.el-form--small .fc-wrap-top.el-form-item>.el-form-item__label{line-height:20px;margin-bottom:4px}.fc-form-footer{margin-top:12px}");const Et={name:"required",load(e,t,i){const r=function(e){return $.Boolean(e)?{required:e}:$.String(e)?{message:e}:$.Undef(e)?{required:!1}:$.Function(e)?{validator:e}:$.Object(e)?e:{}}(e.getValue());if(!1===r.required)e.clearProp(),i.clearValidateState([t.field]);else{const n={required:!0,validator(e,t,i){$.empty(t)?i(n.message):i()},...r};if(n.message){const e=n.message.match(/^\{\{\s*\$t\.(.+)\s*\}\}$/);e&&(n.message=i.t(e[1],{title:t.__fc__.refRule.__$title.value}))}else n.message=t.__fc__.refRule.__$title.value+("en"===i.getLocale()?" is required":"不能为空");e.getProp().validate=[n]}i.sync(t)},watch(...e){Et.load(...e)}};function Rt(e){e.componentAlias(_t),M.forEach((t=>{e.component(t.name,t)})),e.register(Et),$t.forEach((t=>{e.parser(t)})),Object.keys(Vt).forEach((t=>{e.maker[t]=Vt[t]})),"undefined"!=typeof window&&window.ElementPlus&&e.useApp(((e,t)=>{t.use(window.ElementPlus)}))}const Ft=ut({ui:"element-ui",version:"3.2.15",manager:Ct,extendApi:St,install:Rt,attrs:{normal:["col","wrap"],array:["className"],key:["title","info"]}});"undefined"!=typeof window&&(window.formCreate=Ft);const jt=Ft.maker;e.default=Ft,e.maker=jt,Object.defineProperty(e,"__esModule",{value:!0})}));
